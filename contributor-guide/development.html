<!--
Licensed to the Apache Software Foundation (ASF) under one
or more contributor license agreements.  See the NOTICE file
distributed with this work for additional information
regarding copyright ownership.  The ASF licenses this file
to you under the Apache License, Version 2.0 (the
"License"); you may not use this file except in compliance
with the License.  You may obtain a copy of the License at

  http://www.apache.org/licenses/LICENSE-2.0

Unless required by applicable law or agreed to in writing,
software distributed under the License is distributed on an
"AS IS" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
KIND, either express or implied.  See the License for the
specific language governing permissions and limitations
under the License.
-->


<!DOCTYPE html>


<html lang="en" data-content_root="../" data-theme="light">

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>Comet Development Guide &#8212; Apache DataFusion Comet  documentation</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "light";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "light";
  </script>
  <!--
    this give us a css class that will be invisible only if js is disabled
  -->
  <noscript>
    <style>
      .pst-js-only { display: none !important; }

    </style>
  </noscript>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="../_static/styles/theme.css?digest=8878045cc6db502f8baf" rel="stylesheet" />
<link href="../_static/styles/pydata-sphinx-theme.css?digest=8878045cc6db502f8baf" rel="stylesheet" />

    <link rel="stylesheet" type="text/css" href="../_static/pygments.css?v=8f2a1f02" />
    <link rel="stylesheet" type="text/css" href="../_static/theme_overrides.css?v=cd442bcd" />
  
  <!-- So that users can add custom icons -->
  <script src="../_static/scripts/fontawesome.js?digest=8878045cc6db502f8baf"></script>
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../_static/scripts/bootstrap.js?digest=8878045cc6db502f8baf" />
<link rel="preload" as="script" href="../_static/scripts/pydata-sphinx-theme.js?digest=8878045cc6db502f8baf" />

    <script src="../_static/documentation_options.js?v=5929fcd5"></script>
    <script src="../_static/doctools.js?v=9a2dae69"></script>
    <script src="../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script>DOCUMENTATION_OPTIONS.pagename = 'contributor-guide/development';</script>
    <script async="true" defer="true" src="https://buttons.github.io/buttons.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Comet Debugging Guide" href="debugging.html" />
    <link rel="prev" title="Comet Parquet Scan Implementations" href="parquet_scans.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="en"/>
  <meta name="docsearch:version" content="" />
  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="light">

  
  
  <div id="pst-skip-link" class="skip-link d-print-none"><a href="#main-content">Skip to main content</a></div>
  
  <div id="pst-scroll-pixel-helper"></div>
  
  <button type="button" class="btn rounded-pill" id="pst-back-to-top">
    <i class="fa-solid fa-arrow-up"></i>Back to top</button>

  
  <dialog id="pst-search-dialog">
    
<form class="bd-search d-flex align-items-center"
      action="../search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         placeholder="Search the docs ..."
         aria-label="Search the docs ..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form>
  </dialog>

  <div class="pst-async-banner-revealer d-none">
  <aside id="bd-header-version-warning" class="d-none d-print-none" aria-label="Version warning"></aside>
</div>

  
    <header class="bd-header navbar navbar-expand-lg bd-navbar d-print-none">
<div class="bd-header__inner bd-page-width">
  <button class="pst-navbar-icon sidebar-toggle primary-toggle" aria-label="Site navigation">
    <span class="fa-solid fa-bars"></span>
  </button>
  
  
  <div class="col-lg-3 navbar-header-items__start">
    
      <div class="navbar-item">

  
    
  

<a class="navbar-brand logo" href="../index.html">
  
  
  
  
  
    
    
    
    <img src="../_static/DataFusionComet-Logo-Light.png" class="logo__image only-light" alt="Apache DataFusion Comet  documentation - Home"/>
    <img src="../_static/DataFusionComet-Logo-Dark.png" class="logo__image only-dark pst-js-only" alt="Apache DataFusion Comet  documentation - Home"/>
  
  
</a></div>
    
  </div>
  
  <div class="col-lg-9 navbar-header-items">
    
    <div class="me-auto navbar-header-items__center">
      
        <div class="navbar-item">
<nav>
  <ul class="bd-navbar-elements navbar-nav">
    
<li class="nav-item ">
  <a class="nav-link nav-internal" href="../about/index.html">
    Comet Overview
  </a>
</li>


<li class="nav-item ">
  <a class="nav-link nav-internal" href="../user-guide/index.html">
    User Guide
  </a>
</li>


<li class="nav-item current active">
  <a class="nav-link nav-internal" href="index.html">
    Contributor Guide
  </a>
</li>


<li class="nav-item ">
  <a class="nav-link nav-internal" href="../asf/index.html">
    ASF Links
  </a>
</li>

  </ul>
</nav></div>
      
    </div>
    
    
    <div class="navbar-header-items__end">
      
        <div class="navbar-item navbar-persistent--container">
          

<button class="btn search-button-field search-button__button pst-js-only" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
 <i class="fa-solid fa-magnifying-glass"></i>
 <span class="search-button__default-text">Search</span>
 <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd class="kbd-shortcut__modifier">K</kbd></span>
</button>
        </div>
      
      
        <div class="navbar-item"><ul class="navbar-icon-links"
    aria-label="Icon Links">
        <li class="nav-item">
          
          
          
          
          
          
          
          
          <a href="https://github.com/apache/datafusion-comet" title="GitHub" class="nav-link pst-navbar-icon" rel="noopener" target="_blank" data-bs-toggle="tooltip" data-bs-placement="bottom"><i class="fa-brands fa-github fa-lg" aria-hidden="true"></i>
            <span class="sr-only">GitHub</span></a>
        </li>
</ul></div>
      
        <div class="navbar-item">

<button class="btn btn-sm nav-link pst-navbar-icon theme-switch-button pst-js-only" aria-label="Color mode" data-bs-title="Color mode"  data-bs-placement="bottom" data-bs-toggle="tooltip">
  <i class="theme-switch fa-solid fa-sun                fa-lg" data-mode="light" title="Light"></i>
  <i class="theme-switch fa-solid fa-moon               fa-lg" data-mode="dark"  title="Dark"></i>
  <i class="theme-switch fa-solid fa-circle-half-stroke fa-lg" data-mode="auto"  title="System Settings"></i>
</button></div>
      
    </div>
    
  </div>
  
  
    <div class="navbar-persistent--mobile">

<button class="btn search-button-field search-button__button pst-js-only" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
 <i class="fa-solid fa-magnifying-glass"></i>
 <span class="search-button__default-text">Search</span>
 <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd class="kbd-shortcut__modifier">K</kbd></span>
</button>
    </div>
  

  
</div>

    </header>
  

  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      
      
      <dialog id="pst-primary-sidebar-modal"></dialog>
      <div id="pst-primary-sidebar" class="bd-sidebar-primary bd-sidebar">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
      <div class="sidebar-header-items__center">
        
          
          
            <div class="navbar-item">
<nav>
  <ul class="bd-navbar-elements navbar-nav">
    
<li class="nav-item ">
  <a class="nav-link nav-internal" href="../about/index.html">
    Comet Overview
  </a>
</li>


<li class="nav-item ">
  <a class="nav-link nav-internal" href="../user-guide/index.html">
    User Guide
  </a>
</li>


<li class="nav-item current active">
  <a class="nav-link nav-internal" href="index.html">
    Contributor Guide
  </a>
</li>


<li class="nav-item ">
  <a class="nav-link nav-internal" href="../asf/index.html">
    ASF Links
  </a>
</li>

  </ul>
</nav></div>
          
        
      </div>
    
    
    
      <div class="sidebar-header-items__end">
        
          <div class="navbar-item"><ul class="navbar-icon-links"
    aria-label="Icon Links">
        <li class="nav-item">
          
          
          
          
          
          
          
          
          <a href="https://github.com/apache/datafusion-comet" title="GitHub" class="nav-link pst-navbar-icon" rel="noopener" target="_blank" data-bs-toggle="tooltip" data-bs-placement="bottom"><i class="fa-brands fa-github fa-lg" aria-hidden="true"></i>
            <span class="sr-only">GitHub</span></a>
        </li>
</ul></div>
        
          <div class="navbar-item">

<button class="btn btn-sm nav-link pst-navbar-icon theme-switch-button pst-js-only" aria-label="Color mode" data-bs-title="Color mode"  data-bs-placement="bottom" data-bs-toggle="tooltip">
  <i class="theme-switch fa-solid fa-sun                fa-lg" data-mode="light" title="Light"></i>
  <i class="theme-switch fa-solid fa-moon               fa-lg" data-mode="dark"  title="Dark"></i>
  <i class="theme-switch fa-solid fa-circle-half-stroke fa-lg" data-mode="auto"  title="System Settings"></i>
</button></div>
        
      </div>
    
  </div>
  
    <div class="sidebar-primary-items__start sidebar-primary__section">
        <div class="sidebar-primary-item"><!--
Licensed to the Apache Software Foundation (ASF) under one
or more contributor license agreements.  See the NOTICE file
distributed with this work for additional information
regarding copyright ownership.  The ASF licenses this file
to you under the Apache License, Version 2.0 (the
"License"); you may not use this file except in compliance
with the License.  You may obtain a copy of the License at

  http://www.apache.org/licenses/LICENSE-2.0

Unless required by applicable law or agreed to in writing,
software distributed under the License is distributed on an
"AS IS" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
KIND, either express or implied.  See the License for the
specific language governing permissions and limitations
under the License.
-->

<nav class="bd-links" id="bd-docs-nav" aria-label="Main navigation">
  <div class="bd-toc-item active">
    <p aria-level="2" class="caption" role="heading"><span class="caption-text">Index</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../about/index.html">Comet Overview</a></li>
<li class="toctree-l1"><a class="reference internal" href="../user-guide/index.html">User Guide</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="index.html">Contributor Guide</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="contributing.html">Getting Started</a></li>
<li class="toctree-l2"><a class="reference internal" href="plugin_overview.html">Comet Plugin Architecture</a></li>
<li class="toctree-l2"><a class="reference internal" href="plugin_overview.html#plugin-components">Plugin Components</a></li>
<li class="toctree-l2"><a class="reference internal" href="ffi.html">Arrow FFI</a></li>
<li class="toctree-l2"><a class="reference internal" href="jvm_shuffle.html">JVM Shuffle</a></li>
<li class="toctree-l2"><a class="reference internal" href="native_shuffle.html">Native Shuffle</a></li>
<li class="toctree-l2"><a class="reference internal" href="parquet_scans.html">Parquet Scans</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">Development Guide</a></li>
<li class="toctree-l2"><a class="reference internal" href="debugging.html">Debugging Guide</a></li>
<li class="toctree-l2"><a class="reference internal" href="benchmarking.html">Benchmarking Guide</a></li>
<li class="toctree-l2"><a class="reference internal" href="adding_a_new_operator.html">Adding a New Operator</a></li>
<li class="toctree-l2"><a class="reference internal" href="adding_a_new_expression.html">Adding a New Expression</a></li>
<li class="toctree-l2"><a class="reference internal" href="tracing.html">Tracing</a></li>
<li class="toctree-l2"><a class="reference internal" href="profiling_native_code.html">Profiling Native Code</a></li>
<li class="toctree-l2"><a class="reference internal" href="spark-sql-tests.html">Spark SQL Tests</a></li>
<li class="toctree-l2"><a class="reference internal" href="sql-file-tests.html">SQL File Tests</a></li>
<li class="toctree-l2"><a class="reference internal" href="roadmap.html">Roadmap</a></li>
<li class="toctree-l2"><a class="reference internal" href="release_process.html">Release Process</a></li>
<li class="toctree-l2"><a class="reference external" href="https://github.com/apache/datafusion-comet">Github and Issue Tracker</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../asf/index.html">ASF Links</a></li>
</ul>

  </div>
</nav>
</div>
    </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
      <div class="sidebar-primary-item">
<div id="ethical-ad-placement"
      class="flat"
      data-ea-publisher="readthedocs"
      data-ea-type="readthedocs-sidebar"
      data-ea-manual="true">
</div></div>
  </div>


      </div>
      
      <main id="main-content" class="bd-main" role="main">
        
        
          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article d-print-none">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item">

<nav aria-label="Breadcrumb" class="d-print-none">
  <ul class="bd-breadcrumbs">
    
    <li class="breadcrumb-item breadcrumb-home">
      <a href="../index.html" class="nav-link" aria-label="Home">
        <i class="fa-solid fa-home"></i>
      </a>
    </li>
    
    <li class="breadcrumb-item"><a href="index.html" class="nav-link">Comet Contributor Guide</a></li>
    
    <li class="breadcrumb-item active" aria-current="page"><span class="ellipsis">Comet Development Guide</span></li>
  </ul>
</nav>
</div>
      
    </div>
  
  
</div>
</div>
              
              
              
                
<div id="searchbox"></div>
                <article class="bd-article">
                  
  <!--
Licensed to the Apache Software Foundation (ASF) under one
or more contributor license agreements.  See the NOTICE file
distributed with this work for additional information
regarding copyright ownership.  The ASF licenses this file
to you under the Apache License, Version 2.0 (the
"License"); you may not use this file except in compliance
with the License.  You may obtain a copy of the License at

  http://www.apache.org/licenses/LICENSE-2.0

Unless required by applicable law or agreed to in writing,
software distributed under the License is distributed on an
"AS IS" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
KIND, either express or implied.  See the License for the
specific language governing permissions and limitations
under the License.
-->
<section id="comet-development-guide">
<h1>Comet Development Guide<a class="headerlink" href="#comet-development-guide" title="Link to this heading">#</a></h1>
<section id="project-layout">
<h2>Project Layout<a class="headerlink" href="#project-layout" title="Link to this heading">#</a></h2>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>├── common     &lt;- common Java/Scala code
├── conf       &lt;- configuration files
├── native     &lt;- native code, in Rust
├── spark      &lt;- Spark integration
</pre></div>
</div>
</section>
<section id="development-setup">
<h2>Development Setup<a class="headerlink" href="#development-setup" title="Link to this heading">#</a></h2>
<ol class="arabic simple">
<li><p>Make sure <code class="docutils literal notranslate"><span class="pre">JAVA_HOME</span></code> is set and point to JDK using <a class="reference internal" href="../user-guide/latest/installation.html"><span class="std std-doc">support matrix</span></a></p></li>
<li><p>Install Rust toolchain. The easiest way is to use
<a class="reference external" href="https://rustup.rs">rustup</a>.</p></li>
</ol>
</section>
<section id="build-test">
<h2>Build &amp; Test<a class="headerlink" href="#build-test" title="Link to this heading">#</a></h2>
<p>A few common commands are specified in project’s <code class="docutils literal notranslate"><span class="pre">Makefile</span></code>:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">make</span></code>: compile the entire project, but don’t run tests</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">make</span> <span class="pre">test-rust</span></code>: compile the project and run tests in Rust side</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">make</span> <span class="pre">test-jvm</span></code>: compile the project and run tests in Java side</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">make</span> <span class="pre">test</span></code>: compile the project and run tests in both Rust and Java
side.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">make</span> <span class="pre">release</span></code>: compile the project and creates a release build. This
is useful when you want to test Comet local installation in another project
such as Spark.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">make</span> <span class="pre">clean</span></code>: clean up the workspace</p></li>
</ul>
</section>
<section id="common-build-and-test-pitfalls">
<h2>Common Build and Test Pitfalls<a class="headerlink" href="#common-build-and-test-pitfalls" title="Link to this heading">#</a></h2>
<section id="native-code-must-be-built-first">
<h3>Native Code Must Be Built First<a class="headerlink" href="#native-code-must-be-built-first" title="Link to this heading">#</a></h3>
<p>The native Rust code must be compiled before running JVM tests. If you skip this step, tests will
fail because they cannot find the native library. Always run <code class="docutils literal notranslate"><span class="pre">make</span> <span class="pre">core</span></code> (or <code class="docutils literal notranslate"><span class="pre">cd</span> <span class="pre">native</span> <span class="pre">&amp;&amp;</span> <span class="pre">cargo</span> <span class="pre">build</span></code>)
before running Maven tests.</p>
<div class="highlight-sh notranslate"><div class="highlight"><pre><span></span><span class="c1"># Correct order</span>
make<span class="w"> </span>core<span class="w">                    </span><span class="c1"># Build native code first</span>
./mvnw<span class="w"> </span><span class="nb">test</span><span class="w"> </span>-Dsuites<span class="o">=</span><span class="s2">&quot;...&quot;</span><span class="w">   </span><span class="c1"># Then run JVM tests</span>
</pre></div>
</div>
</section>
<section id="debug-vs-release-mode">
<h3>Debug vs Release Mode<a class="headerlink" href="#debug-vs-release-mode" title="Link to this heading">#</a></h3>
<p>There is no need to use release mode (<code class="docutils literal notranslate"><span class="pre">make</span> <span class="pre">release</span></code>) during normal development. Debug builds
are faster to compile and provide better error messages. Only use release mode when:</p>
<ul class="simple">
<li><p>Running benchmarks</p></li>
<li><p>Testing performance</p></li>
<li><p>Creating a release build for deployment</p></li>
</ul>
<p>For regular development and testing, use <code class="docutils literal notranslate"><span class="pre">make</span></code> or <code class="docutils literal notranslate"><span class="pre">make</span> <span class="pre">core</span></code> which build in debug mode.</p>
</section>
<section id="running-rust-tests">
<h3>Running Rust Tests<a class="headerlink" href="#running-rust-tests" title="Link to this heading">#</a></h3>
<p>When running Rust tests directly with <code class="docutils literal notranslate"><span class="pre">cargo</span> <span class="pre">test</span></code>, the JVM library (<code class="docutils literal notranslate"><span class="pre">libjvm.so</span></code>) must be on
your library path. Set the <code class="docutils literal notranslate"><span class="pre">LD_LIBRARY_PATH</span></code> environment variable to include your JDK’s <code class="docutils literal notranslate"><span class="pre">lib/server</span></code>
directory:</p>
<div class="highlight-sh notranslate"><div class="highlight"><pre><span></span><span class="c1"># Find your libjvm.so location (example for typical JDK installation)</span>
<span class="nb">export</span><span class="w"> </span><span class="nv">LD_LIBRARY_PATH</span><span class="o">=</span><span class="nv">$JAVA_HOME</span>/lib/server:<span class="nv">$LD_LIBRARY_PATH</span>

<span class="c1"># Now you can run Rust tests</span>
<span class="nb">cd</span><span class="w"> </span>native<span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span>cargo<span class="w"> </span><span class="nb">test</span>
</pre></div>
</div>
<p>Alternatively, use <code class="docutils literal notranslate"><span class="pre">make</span> <span class="pre">test-rust</span></code> which handles the JVM compilation dependency automatically.</p>
</section>
<section id="avoid-using-pl-to-select-modules">
<h3>Avoid Using <code class="docutils literal notranslate"><span class="pre">-pl</span></code> to Select Modules<a class="headerlink" href="#avoid-using-pl-to-select-modules" title="Link to this heading">#</a></h3>
<p>When running Maven tests, avoid using <code class="docutils literal notranslate"><span class="pre">-pl</span> <span class="pre">spark</span></code> to select only the spark module. This can cause
Maven to pick up the <code class="docutils literal notranslate"><span class="pre">common</span></code> module from your local Maven repository instead of using the current
codebase, leading to inconsistent test results:</p>
<div class="highlight-sh notranslate"><div class="highlight"><pre><span></span><span class="c1"># Avoid this - may use stale common module from local repo</span>
./mvnw<span class="w"> </span><span class="nb">test</span><span class="w"> </span>-pl<span class="w"> </span>spark<span class="w"> </span>-Dsuites<span class="o">=</span><span class="s2">&quot;...&quot;</span>

<span class="c1"># Do this instead - builds and tests with current code</span>
./mvnw<span class="w"> </span><span class="nb">test</span><span class="w"> </span>-Dsuites<span class="o">=</span><span class="s2">&quot;...&quot;</span>
</pre></div>
</div>
</section>
<section id="use-wildcardsuites-for-running-tests">
<h3>Use <code class="docutils literal notranslate"><span class="pre">wildcardSuites</span></code> for Running Tests<a class="headerlink" href="#use-wildcardsuites-for-running-tests" title="Link to this heading">#</a></h3>
<p>When running specific test suites, use <code class="docutils literal notranslate"><span class="pre">wildcardSuites</span></code> instead of <code class="docutils literal notranslate"><span class="pre">suites</span></code> for more flexible
matching. The <code class="docutils literal notranslate"><span class="pre">wildcardSuites</span></code> parameter allows partial matching of suite names:</p>
<div class="highlight-sh notranslate"><div class="highlight"><pre><span></span><span class="c1"># Run all suites containing &quot;CometCast&quot;</span>
./mvnw<span class="w"> </span><span class="nb">test</span><span class="w"> </span>-DwildcardSuites<span class="o">=</span><span class="s2">&quot;CometCast&quot;</span>

<span class="c1"># Run specific suite with filter</span>
./mvnw<span class="w"> </span><span class="nb">test</span><span class="w"> </span>-Dsuites<span class="o">=</span><span class="s2">&quot;org.apache.comet.CometCastSuite valid&quot;</span>
</pre></div>
</div>
</section>
</section>
<section id="development-environment">
<h2>Development Environment<a class="headerlink" href="#development-environment" title="Link to this heading">#</a></h2>
<p>Comet is a multi-language project with native code written in Rust and JVM code written in Java and Scala.
For Rust code, the CLion IDE is recommended. For JVM code, IntelliJ IDEA is recommended.</p>
<p>Before opening the project in an IDE, make sure to run <code class="docutils literal notranslate"><span class="pre">make</span></code> first to generate the necessary files for the IDEs. Currently, it’s mostly about
generating protobuf message classes for the JVM side. It’s only required to run <code class="docutils literal notranslate"><span class="pre">make</span></code> once after cloning the repo.</p>
<section id="intellij-idea">
<h3>IntelliJ IDEA<a class="headerlink" href="#intellij-idea" title="Link to this heading">#</a></h3>
<p>First make sure to install the Scala plugin in IntelliJ IDEA.
After that, you can open the project in IntelliJ IDEA. The IDE should automatically detect the project structure and import as a Maven project.</p>
<p>Comet uses generated source files that are too large for IntelliJ’s default size limit for code inspections. To avoid IDE errors
(missing definitions, etc.) caused by IntelliJ skipping these generated files, modify
<a class="reference external" href="https://intellij-support.jetbrains.com/hc/en-us/articles/206544869-Configuring-JVM-options-and-platform-properties">IntelliJ’s Platform Properties</a>
by going to <code class="docutils literal notranslate"><span class="pre">Help</span> <span class="pre">-&gt;</span> <span class="pre">Edit</span> <span class="pre">Custom</span> <span class="pre">Properties...</span></code>. For example, adding <code class="docutils literal notranslate"><span class="pre">idea.max.intellisense.filesize=16384</span></code> increases the file
size limit to 16 MB.</p>
</section>
<section id="clion">
<h3>CLion<a class="headerlink" href="#clion" title="Link to this heading">#</a></h3>
<p>First make sure to install the Rust plugin in CLion or you can use the dedicated Rust IDE: RustRover.
After that you can open the project in CLion. The IDE should automatically detect the project structure and import as a Cargo project.</p>
</section>
<section id="sql-file-tests-recommended-for-expressions">
<h3>SQL file tests (recommended for expressions)<a class="headerlink" href="#sql-file-tests-recommended-for-expressions" title="Link to this heading">#</a></h3>
<p>For testing expressions and operators, prefer using SQL file tests over writing Scala test
code. SQL file tests are plain <code class="docutils literal notranslate"><span class="pre">.sql</span></code> files that are automatically discovered and executed –
no Scala code to write, and no recompilation needed when tests change. This makes it easy to
iterate quickly and to get good coverage of edge cases and argument combinations.</p>
<p>See the <a class="reference internal" href="sql-file-tests.html"><span class="doc std std-doc">SQL File Tests</span></a> guide for the full documentation on how to write
and run these tests.</p>
</section>
<section id="running-tests-in-idea">
<h3>Running Tests in IDEA<a class="headerlink" href="#running-tests-in-idea" title="Link to this heading">#</a></h3>
<p>Like other Maven projects, you can run tests in IntelliJ IDEA by right-clicking on the test class or test method and selecting “Run” or “Debug”.
However if the tests is related to the native side. Please make sure to run <code class="docutils literal notranslate"><span class="pre">make</span> <span class="pre">core</span></code> or <code class="docutils literal notranslate"><span class="pre">cd</span> <span class="pre">native</span> <span class="pre">&amp;&amp;</span> <span class="pre">cargo</span> <span class="pre">build</span></code> before running the tests in IDEA.</p>
</section>
<section id="running-tests-from-command-line">
<h3>Running Tests from command line<a class="headerlink" href="#running-tests-from-command-line" title="Link to this heading">#</a></h3>
<p>It is possible to specify which ScalaTest suites you want to run from the CLI using the <code class="docutils literal notranslate"><span class="pre">suites</span></code>
argument, for example if you only want to execute the test cases that contains <em>valid</em>
in their name in <code class="docutils literal notranslate"><span class="pre">org.apache.comet.CometCastSuite</span></code> you can use</p>
<div class="highlight-sh notranslate"><div class="highlight"><pre><span></span>./mvnw<span class="w"> </span><span class="nb">test</span><span class="w"> </span>-Dtest<span class="o">=</span>none<span class="w"> </span>-Dsuites<span class="o">=</span><span class="s2">&quot;org.apache.comet.CometCastSuite valid&quot;</span>
</pre></div>
</div>
<p>Other options for selecting specific suites are described in the <a class="reference external" href="https://www.scalatest.org/user_guide/using_the_scalatest_maven_plugin">ScalaTest Maven Plugin documentation</a></p>
</section>
</section>
<section id="plan-stability-testing">
<h2>Plan Stability Testing<a class="headerlink" href="#plan-stability-testing" title="Link to this heading">#</a></h2>
<p>Comet has a plan stability testing framework that can be used to test the stability of the query plans generated by Comet.
The plan stability testing framework is located in the <code class="docutils literal notranslate"><span class="pre">spark</span></code> module.</p>
<section id="using-the-helper-script">
<h3>Using the Helper Script<a class="headerlink" href="#using-the-helper-script" title="Link to this heading">#</a></h3>
<p>The easiest way to regenerate golden files is to use the provided script:</p>
<div class="highlight-sh notranslate"><div class="highlight"><pre><span></span><span class="c1"># Regenerate golden files for all Spark versions</span>
./dev/regenerate-golden-files.sh

<span class="c1"># Regenerate only for a specific Spark version</span>
./dev/regenerate-golden-files.sh<span class="w"> </span>--spark-version<span class="w"> </span><span class="m">3</span>.5
</pre></div>
</div>
<p>The script verifies that JDK 17+ is configured (required for Spark 4.0), installs Comet for each
Spark version, and runs the plan stability tests with <code class="docutils literal notranslate"><span class="pre">SPARK_GENERATE_GOLDEN_FILES=1</span></code>.</p>
</section>
<section id="manual-instructions">
<h3>Manual Instructions<a class="headerlink" href="#manual-instructions" title="Link to this heading">#</a></h3>
<p>Alternatively, you can run the tests manually using the following commands.</p>
<p>Note that the output files get written to <code class="docutils literal notranslate"><span class="pre">$SPARK_HOME</span></code>.</p>
<p>The tests can be run with:</p>
<div class="highlight-sh notranslate"><div class="highlight"><pre><span></span><span class="nb">export</span><span class="w"> </span><span class="nv">SPARK_HOME</span><span class="o">=</span><span class="sb">`</span><span class="nb">pwd</span><span class="sb">`</span>
./mvnw<span class="w"> </span>-Dsuites<span class="o">=</span><span class="s2">&quot;org.apache.spark.sql.comet.CometTPCDSV1_4_PlanStabilitySuite&quot;</span><span class="w"> </span>-Pspark-3.4<span class="w"> </span>-nsu<span class="w"> </span><span class="nb">test</span>
./mvnw<span class="w"> </span>-Dsuites<span class="o">=</span><span class="s2">&quot;org.apache.spark.sql.comet.CometTPCDSV1_4_PlanStabilitySuite&quot;</span><span class="w"> </span>-Pspark-3.5<span class="w"> </span>-nsu<span class="w"> </span><span class="nb">test</span>
./mvnw<span class="w"> </span>-Dsuites<span class="o">=</span><span class="s2">&quot;org.apache.spark.sql.comet.CometTPCDSV1_4_PlanStabilitySuite&quot;</span><span class="w"> </span>-Pspark-4.0<span class="w"> </span>-nsu<span class="w"> </span><span class="nb">test</span>
</pre></div>
</div>
<p>and</p>
<div class="highlight-sh notranslate"><div class="highlight"><pre><span></span><span class="nb">export</span><span class="w"> </span><span class="nv">SPARK_HOME</span><span class="o">=</span><span class="sb">`</span><span class="nb">pwd</span><span class="sb">`</span>
./mvnw<span class="w"> </span>-Dsuites<span class="o">=</span><span class="s2">&quot;org.apache.spark.sql.comet.CometTPCDSV2_7_PlanStabilitySuite&quot;</span><span class="w"> </span>-Pspark-3.4<span class="w"> </span>-nsu<span class="w"> </span><span class="nb">test</span>
./mvnw<span class="w"> </span>-Dsuites<span class="o">=</span><span class="s2">&quot;org.apache.spark.sql.comet.CometTPCDSV2_7_PlanStabilitySuite&quot;</span><span class="w"> </span>-Pspark-3.5<span class="w"> </span>-nsu<span class="w"> </span><span class="nb">test</span>
./mvnw<span class="w"> </span>-Dsuites<span class="o">=</span><span class="s2">&quot;org.apache.spark.sql.comet.CometTPCDSV2_7_PlanStabilitySuite&quot;</span><span class="w"> </span>-Pspark-4.0<span class="w"> </span>-nsu<span class="w"> </span><span class="nb">test</span>
</pre></div>
</div>
<p>If your pull request changes the query plans generated by Comet, you should regenerate the golden files.
To regenerate the golden files, you can run the following commands.</p>
<div class="highlight-sh notranslate"><div class="highlight"><pre><span></span><span class="nb">export</span><span class="w"> </span><span class="nv">SPARK_HOME</span><span class="o">=</span><span class="sb">`</span><span class="nb">pwd</span><span class="sb">`</span>
<span class="nv">SPARK_GENERATE_GOLDEN_FILES</span><span class="o">=</span><span class="m">1</span><span class="w"> </span>./mvnw<span class="w"> </span>-Dsuites<span class="o">=</span><span class="s2">&quot;org.apache.spark.sql.comet.CometTPCDSV1_4_PlanStabilitySuite&quot;</span><span class="w"> </span>-Pspark-3.4<span class="w"> </span>-nsu<span class="w"> </span><span class="nb">test</span>
<span class="nv">SPARK_GENERATE_GOLDEN_FILES</span><span class="o">=</span><span class="m">1</span><span class="w"> </span>./mvnw<span class="w"> </span>-Dsuites<span class="o">=</span><span class="s2">&quot;org.apache.spark.sql.comet.CometTPCDSV1_4_PlanStabilitySuite&quot;</span><span class="w"> </span>-Pspark-3.5<span class="w"> </span>-nsu<span class="w"> </span><span class="nb">test</span>
<span class="nv">SPARK_GENERATE_GOLDEN_FILES</span><span class="o">=</span><span class="m">1</span><span class="w"> </span>./mvnw<span class="w"> </span>-Dsuites<span class="o">=</span><span class="s2">&quot;org.apache.spark.sql.comet.CometTPCDSV1_4_PlanStabilitySuite&quot;</span><span class="w"> </span>-Pspark-4.0<span class="w"> </span>-nsu<span class="w"> </span><span class="nb">test</span>
</pre></div>
</div>
<p>and</p>
<div class="highlight-sh notranslate"><div class="highlight"><pre><span></span><span class="nb">export</span><span class="w"> </span><span class="nv">SPARK_HOME</span><span class="o">=</span><span class="sb">`</span><span class="nb">pwd</span><span class="sb">`</span>
<span class="nv">SPARK_GENERATE_GOLDEN_FILES</span><span class="o">=</span><span class="m">1</span><span class="w"> </span>./mvnw<span class="w"> </span>-Dsuites<span class="o">=</span><span class="s2">&quot;org.apache.spark.sql.comet.CometTPCDSV2_7_PlanStabilitySuite&quot;</span><span class="w"> </span>-Pspark-3.4<span class="w"> </span>-nsu<span class="w"> </span><span class="nb">test</span>
<span class="nv">SPARK_GENERATE_GOLDEN_FILES</span><span class="o">=</span><span class="m">1</span><span class="w"> </span>./mvnw<span class="w"> </span>-Dsuites<span class="o">=</span><span class="s2">&quot;org.apache.spark.sql.comet.CometTPCDSV2_7_PlanStabilitySuite&quot;</span><span class="w"> </span>-Pspark-3.5<span class="w"> </span>-nsu<span class="w"> </span><span class="nb">test</span>
<span class="nv">SPARK_GENERATE_GOLDEN_FILES</span><span class="o">=</span><span class="m">1</span><span class="w"> </span>./mvnw<span class="w"> </span>-Dsuites<span class="o">=</span><span class="s2">&quot;org.apache.spark.sql.comet.CometTPCDSV2_7_PlanStabilitySuite&quot;</span><span class="w"> </span>-Pspark-4.0<span class="w"> </span>-nsu<span class="w"> </span><span class="nb">test</span>
</pre></div>
</div>
</section>
</section>
<section id="benchmark">
<h2>Benchmark<a class="headerlink" href="#benchmark" title="Link to this heading">#</a></h2>
<p>There’s a <code class="docutils literal notranslate"><span class="pre">make</span></code> command to run micro benchmarks in the repo. For
instance:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">make</span> <span class="n">benchmark</span><span class="o">-</span><span class="n">org</span><span class="o">.</span><span class="n">apache</span><span class="o">.</span><span class="n">spark</span><span class="o">.</span><span class="n">sql</span><span class="o">.</span><span class="n">benchmark</span><span class="o">.</span><span class="n">CometReadBenchmark</span>
</pre></div>
</div>
<p>To run TPC-H or TPC-DS micro benchmarks, please follow the instructions
in the respective source code, e.g., <code class="docutils literal notranslate"><span class="pre">CometTPCHQueryBenchmark</span></code>.</p>
</section>
<section id="debugging">
<h2>Debugging<a class="headerlink" href="#debugging" title="Link to this heading">#</a></h2>
<p>Comet is a multi-language project with native code written in Rust and JVM code written in Java and Scala.
It is possible to debug both native and JVM code concurrently as described in the <a class="reference internal" href="debugging.html"><span class="doc std std-doc">DEBUGGING guide</span></a></p>
</section>
<section id="submitting-a-pull-request">
<h2>Submitting a Pull Request<a class="headerlink" href="#submitting-a-pull-request" title="Link to this heading">#</a></h2>
<p>Before submitting a pull request, follow this checklist to ensure your changes are ready:</p>
<section id="format-your-code">
<h3>1. Format Your Code<a class="headerlink" href="#format-your-code" title="Link to this heading">#</a></h3>
<p>Comet uses <code class="docutils literal notranslate"><span class="pre">cargo</span> <span class="pre">fmt</span></code>, <a class="reference external" href="https://github.com/scalacenter/scalafix">Scalafix</a> and <a class="reference external" href="https://github.com/diffplug/spotless/tree/main/plugin-maven">Spotless</a> to
automatically format the code. Run the following command to format all code:</p>
<div class="highlight-sh notranslate"><div class="highlight"><pre><span></span>make<span class="w"> </span>format
</pre></div>
</div>
</section>
<section id="build-and-verify">
<h3>2. Build and Verify<a class="headerlink" href="#build-and-verify" title="Link to this heading">#</a></h3>
<p>After formatting, run a full build to ensure everything compiles correctly and generated
documentation is up to date:</p>
<div class="highlight-sh notranslate"><div class="highlight"><pre><span></span>make
</pre></div>
</div>
<p>This builds both native and JVM code. Fix any compilation errors before proceeding.</p>
</section>
<section id="run-clippy-recommended">
<h3>3. Run Clippy (Recommended)<a class="headerlink" href="#run-clippy-recommended" title="Link to this heading">#</a></h3>
<p>It’s strongly recommended to run Clippy locally to catch potential issues before the CI/CD pipeline does. You can run the same Clippy checks used in CI/CD with:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="nb">cd</span><span class="w"> </span>native
cargo<span class="w"> </span>clippy<span class="w"> </span>--color<span class="o">=</span>never<span class="w"> </span>--all-targets<span class="w"> </span>--workspace<span class="w"> </span>--<span class="w"> </span>-D<span class="w"> </span>warnings
</pre></div>
</div>
<p>Make sure to resolve any Clippy warnings before submitting your pull request, as the CI/CD pipeline will fail if warnings are present.</p>
</section>
<section id="run-tests">
<h3>4. Run Tests<a class="headerlink" href="#run-tests" title="Link to this heading">#</a></h3>
<p>Run the relevant tests for your changes:</p>
<div class="highlight-sh notranslate"><div class="highlight"><pre><span></span><span class="c1"># Run all tests</span>
make<span class="w"> </span><span class="nb">test</span>

<span class="c1"># Or run only Rust tests</span>
make<span class="w"> </span>test-rust

<span class="c1"># Or run only JVM tests (native must be built first)</span>
make<span class="w"> </span>test-jvm
</pre></div>
</div>
</section>
<section id="pre-pr-summary">
<h3>Pre-PR Summary<a class="headerlink" href="#pre-pr-summary" title="Link to this heading">#</a></h3>
<div class="highlight-sh notranslate"><div class="highlight"><pre><span></span>make<span class="w"> </span>format<span class="w">   </span><span class="c1"># Format code</span>
make<span class="w">          </span><span class="c1"># Build everything and update generated docs</span>
make<span class="w"> </span><span class="nb">test</span><span class="w">     </span><span class="c1"># Run tests (optional but recommended)</span>
</pre></div>
</div>
</section>
</section>
<section id="how-to-format-md-document">
<h2>How to format <code class="docutils literal notranslate"><span class="pre">.md</span></code> document<a class="headerlink" href="#how-to-format-md-document" title="Link to this heading">#</a></h2>
<p>We are using <code class="docutils literal notranslate"><span class="pre">prettier</span></code> to format <code class="docutils literal notranslate"><span class="pre">.md</span></code> files.</p>
<p>You can either use <code class="docutils literal notranslate"><span class="pre">npm</span> <span class="pre">i</span> <span class="pre">-g</span> <span class="pre">prettier</span></code> to install it globally or use <code class="docutils literal notranslate"><span class="pre">npx</span></code> to run it as a standalone binary. Using <code class="docutils literal notranslate"><span class="pre">npx</span></code> required a working node environment. Upgrading to the latest prettier is recommended (by adding <code class="docutils literal notranslate"><span class="pre">--upgrade</span></code> to the <code class="docutils literal notranslate"><span class="pre">npm</span></code> command).</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$<span class="w"> </span>prettier<span class="w"> </span>--version
<span class="m">2</span>.3.0
</pre></div>
</div>
<p>After you’ve confirmed your prettier version, you can format all the <code class="docutils literal notranslate"><span class="pre">.md</span></code> files:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>npx<span class="w"> </span>prettier<span class="w"> </span><span class="s2">&quot;**/*.md&quot;</span><span class="w"> </span>--write
</pre></div>
</div>
</section>
</section>


                </article>
              
              
              
              
              
                <footer class="prev-next-footer d-print-none">
                  
<div class="prev-next-area">
    <a class="left-prev"
       href="parquet_scans.html"
       title="previous page">
      <i class="fa-solid fa-angle-left"></i>
      <div class="prev-next-info">
        <p class="prev-next-subtitle">previous</p>
        <p class="prev-next-title">Comet Parquet Scan Implementations</p>
      </div>
    </a>
    <a class="right-next"
       href="debugging.html"
       title="next page">
      <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title">Comet Debugging Guide</p>
      </div>
      <i class="fa-solid fa-angle-right"></i>
    </a>
</div>
                </footer>
              
            </div>
            
            
              
            
          </div>
          <footer class="bd-footer-content">
            
          </footer>
        
      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script defer src="../_static/scripts/bootstrap.js?digest=8878045cc6db502f8baf"></script>
<script defer src="../_static/scripts/pydata-sphinx-theme.js?digest=8878045cc6db502f8baf"></script>

<!-- Based on pydata_sphinx_theme/footer.html -->
<footer class="footer mt-5 mt-md-0">
  <div class="container">
    
    <div class="footer-item">
      <p>Apache DataFusion, Apache DataFusion Comet, Apache, the Apache feather logo, and the Apache DataFusion project logo</p>
      <p>are either registered trademarks or trademarks of The Apache Software Foundation in the United States and other countries.</p>
    </div>
  </div>
</footer>


  </body>
</html>