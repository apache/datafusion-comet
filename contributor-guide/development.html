<!--
Licensed to the Apache Software Foundation (ASF) under one
or more contributor license agreements.  See the NOTICE file
distributed with this work for additional information
regarding copyright ownership.  The ASF licenses this file
to you under the Apache License, Version 2.0 (the
"License"); you may not use this file except in compliance
with the License.  You may obtain a copy of the License at

  http://www.apache.org/licenses/LICENSE-2.0

Unless required by applicable law or agreed to in writing,
software distributed under the License is distributed on an
"AS IS" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
KIND, either express or implied.  See the License for the
specific language governing permissions and limitations
under the License.
-->


<!DOCTYPE html>


<html lang="en" data-content_root="../" data-theme="light">

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>Comet Development Guide &#8212; Apache DataFusion Comet  documentation</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "light";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "light";
  </script>
  <!--
    this give us a css class that will be invisible only if js is disabled
  -->
  <noscript>
    <style>
      .pst-js-only { display: none !important; }

    </style>
  </noscript>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="../_static/styles/theme.css?digest=8878045cc6db502f8baf" rel="stylesheet" />
<link href="../_static/styles/pydata-sphinx-theme.css?digest=8878045cc6db502f8baf" rel="stylesheet" />

    <link rel="stylesheet" type="text/css" href="../_static/pygments.css?v=8f2a1f02" />
    <link rel="stylesheet" type="text/css" href="../_static/theme_overrides.css?v=cd442bcd" />
  
  <!-- So that users can add custom icons -->
  <script src="../_static/scripts/fontawesome.js?digest=8878045cc6db502f8baf"></script>
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../_static/scripts/bootstrap.js?digest=8878045cc6db502f8baf" />
<link rel="preload" as="script" href="../_static/scripts/pydata-sphinx-theme.js?digest=8878045cc6db502f8baf" />

    <script src="../_static/documentation_options.js?v=5929fcd5"></script>
    <script src="../_static/doctools.js?v=9a2dae69"></script>
    <script src="../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script>DOCUMENTATION_OPTIONS.pagename = 'contributor-guide/development';</script>
    <script async="true" defer="true" src="https://buttons.github.io/buttons.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Comet Debugging Guide" href="debugging.html" />
    <link rel="prev" title="Comet Plugin Architecture" href="plugin_overview.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="en"/>
  <meta name="docsearch:version" content="" />
  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="light">

  
  
  <div id="pst-skip-link" class="skip-link d-print-none"><a href="#main-content">Skip to main content</a></div>
  
  <div id="pst-scroll-pixel-helper"></div>
  
  <button type="button" class="btn rounded-pill" id="pst-back-to-top">
    <i class="fa-solid fa-arrow-up"></i>Back to top</button>

  
  <dialog id="pst-search-dialog">
    
<form class="bd-search d-flex align-items-center"
      action="../search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         placeholder="Search the docs ..."
         aria-label="Search the docs ..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form>
  </dialog>

  <div class="pst-async-banner-revealer d-none">
  <aside id="bd-header-version-warning" class="d-none d-print-none" aria-label="Version warning"></aside>
</div>

  
    <header class="bd-header navbar navbar-expand-lg bd-navbar d-print-none">
<div class="bd-header__inner bd-page-width">
  <button class="pst-navbar-icon sidebar-toggle primary-toggle" aria-label="Site navigation">
    <span class="fa-solid fa-bars"></span>
  </button>
  
  
  <div class="col-lg-3 navbar-header-items__start">
    
      <div class="navbar-item">

  
    
  

<a class="navbar-brand logo" href="../index.html">
  
  
  
  
  
    
    
    
    <img src="../_static/DataFusionComet-Logo-Light.png" class="logo__image only-light" alt="Apache DataFusion Comet  documentation - Home"/>
    <img src="../_static/DataFusionComet-Logo-Dark.png" class="logo__image only-dark pst-js-only" alt="Apache DataFusion Comet  documentation - Home"/>
  
  
</a></div>
    
  </div>
  
  <div class="col-lg-9 navbar-header-items">
    
    <div class="me-auto navbar-header-items__center">
      
        <div class="navbar-item">
<nav>
  <ul class="bd-navbar-elements navbar-nav">
    
<li class="nav-item ">
  <a class="nav-link nav-internal" href="../about/index.html">
    Comet Overview
  </a>
</li>


<li class="nav-item ">
  <a class="nav-link nav-internal" href="../user-guide/index.html">
    User Guide
  </a>
</li>


<li class="nav-item current active">
  <a class="nav-link nav-internal" href="index.html">
    Contributor Guide
  </a>
</li>


<li class="nav-item ">
  <a class="nav-link nav-internal" href="../asf/index.html">
    ASF Links
  </a>
</li>

  </ul>
</nav></div>
      
    </div>
    
    
    <div class="navbar-header-items__end">
      
        <div class="navbar-item navbar-persistent--container">
          

<button class="btn search-button-field search-button__button pst-js-only" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
 <i class="fa-solid fa-magnifying-glass"></i>
 <span class="search-button__default-text">Search</span>
 <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd class="kbd-shortcut__modifier">K</kbd></span>
</button>
        </div>
      
      
        <div class="navbar-item"><ul class="navbar-icon-links"
    aria-label="Icon Links">
        <li class="nav-item">
          
          
          
          
          
          
          
          
          <a href="https://github.com/apache/datafusion-comet" title="GitHub" class="nav-link pst-navbar-icon" rel="noopener" target="_blank" data-bs-toggle="tooltip" data-bs-placement="bottom"><i class="fa-brands fa-github fa-lg" aria-hidden="true"></i>
            <span class="sr-only">GitHub</span></a>
        </li>
</ul></div>
      
        <div class="navbar-item">

<button class="btn btn-sm nav-link pst-navbar-icon theme-switch-button pst-js-only" aria-label="Color mode" data-bs-title="Color mode"  data-bs-placement="bottom" data-bs-toggle="tooltip">
  <i class="theme-switch fa-solid fa-sun                fa-lg" data-mode="light" title="Light"></i>
  <i class="theme-switch fa-solid fa-moon               fa-lg" data-mode="dark"  title="Dark"></i>
  <i class="theme-switch fa-solid fa-circle-half-stroke fa-lg" data-mode="auto"  title="System Settings"></i>
</button></div>
      
    </div>
    
  </div>
  
  
    <div class="navbar-persistent--mobile">

<button class="btn search-button-field search-button__button pst-js-only" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
 <i class="fa-solid fa-magnifying-glass"></i>
 <span class="search-button__default-text">Search</span>
 <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd class="kbd-shortcut__modifier">K</kbd></span>
</button>
    </div>
  

  
</div>

    </header>
  

  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      
      
      <dialog id="pst-primary-sidebar-modal"></dialog>
      <div id="pst-primary-sidebar" class="bd-sidebar-primary bd-sidebar">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
      <div class="sidebar-header-items__center">
        
          
          
            <div class="navbar-item">
<nav>
  <ul class="bd-navbar-elements navbar-nav">
    
<li class="nav-item ">
  <a class="nav-link nav-internal" href="../about/index.html">
    Comet Overview
  </a>
</li>


<li class="nav-item ">
  <a class="nav-link nav-internal" href="../user-guide/index.html">
    User Guide
  </a>
</li>


<li class="nav-item current active">
  <a class="nav-link nav-internal" href="index.html">
    Contributor Guide
  </a>
</li>


<li class="nav-item ">
  <a class="nav-link nav-internal" href="../asf/index.html">
    ASF Links
  </a>
</li>

  </ul>
</nav></div>
          
        
      </div>
    
    
    
      <div class="sidebar-header-items__end">
        
          <div class="navbar-item"><ul class="navbar-icon-links"
    aria-label="Icon Links">
        <li class="nav-item">
          
          
          
          
          
          
          
          
          <a href="https://github.com/apache/datafusion-comet" title="GitHub" class="nav-link pst-navbar-icon" rel="noopener" target="_blank" data-bs-toggle="tooltip" data-bs-placement="bottom"><i class="fa-brands fa-github fa-lg" aria-hidden="true"></i>
            <span class="sr-only">GitHub</span></a>
        </li>
</ul></div>
        
          <div class="navbar-item">

<button class="btn btn-sm nav-link pst-navbar-icon theme-switch-button pst-js-only" aria-label="Color mode" data-bs-title="Color mode"  data-bs-placement="bottom" data-bs-toggle="tooltip">
  <i class="theme-switch fa-solid fa-sun                fa-lg" data-mode="light" title="Light"></i>
  <i class="theme-switch fa-solid fa-moon               fa-lg" data-mode="dark"  title="Dark"></i>
  <i class="theme-switch fa-solid fa-circle-half-stroke fa-lg" data-mode="auto"  title="System Settings"></i>
</button></div>
        
      </div>
    
  </div>
  
    <div class="sidebar-primary-items__start sidebar-primary__section">
        <div class="sidebar-primary-item"><!--
Licensed to the Apache Software Foundation (ASF) under one
or more contributor license agreements.  See the NOTICE file
distributed with this work for additional information
regarding copyright ownership.  The ASF licenses this file
to you under the Apache License, Version 2.0 (the
"License"); you may not use this file except in compliance
with the License.  You may obtain a copy of the License at

  http://www.apache.org/licenses/LICENSE-2.0

Unless required by applicable law or agreed to in writing,
software distributed under the License is distributed on an
"AS IS" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
KIND, either express or implied.  See the License for the
specific language governing permissions and limitations
under the License.
-->

<nav class="bd-links" id="bd-docs-nav" aria-label="Main navigation">
  <div class="bd-toc-item active">
    <p aria-level="2" class="caption" role="heading"><span class="caption-text">Index</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../about/index.html">Comet Overview</a></li>
<li class="toctree-l1"><a class="reference internal" href="../user-guide/index.html">User Guide</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="index.html">Contributor Guide</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="contributing.html">Getting Started</a></li>
<li class="toctree-l2"><a class="reference internal" href="plugin_overview.html">Comet Plugin Architecture</a></li>
<li class="toctree-l2"><a class="reference internal" href="plugin_overview.html#plugin-components">Plugin Components</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">Development Guide</a></li>
<li class="toctree-l2"><a class="reference internal" href="debugging.html">Debugging Guide</a></li>
<li class="toctree-l2"><a class="reference internal" href="benchmarking.html">Benchmarking Guide</a></li>
<li class="toctree-l2"><a class="reference internal" href="adding_a_new_expression.html">Adding a New Expression</a></li>
<li class="toctree-l2"><a class="reference internal" href="tracing.html">Tracing</a></li>
<li class="toctree-l2"><a class="reference internal" href="profiling_native_code.html">Profiling Native Code</a></li>
<li class="toctree-l2"><a class="reference internal" href="spark-sql-tests.html">Spark SQL Tests</a></li>
<li class="toctree-l2"><a class="reference internal" href="roadmap.html">Roadmap</a></li>
<li class="toctree-l2"><a class="reference external" href="https://github.com/apache/datafusion-comet">Github and Issue Tracker</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../asf/index.html">ASF Links</a></li>
</ul>

  </div>
</nav>
</div>
    </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
      <div class="sidebar-primary-item">
<div id="ethical-ad-placement"
      class="flat"
      data-ea-publisher="readthedocs"
      data-ea-type="readthedocs-sidebar"
      data-ea-manual="true">
</div></div>
  </div>


      </div>
      
      <main id="main-content" class="bd-main" role="main">
        
        
          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article d-print-none">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item">

<nav aria-label="Breadcrumb" class="d-print-none">
  <ul class="bd-breadcrumbs">
    
    <li class="breadcrumb-item breadcrumb-home">
      <a href="../index.html" class="nav-link" aria-label="Home">
        <i class="fa-solid fa-home"></i>
      </a>
    </li>
    
    <li class="breadcrumb-item"><a href="index.html" class="nav-link">Comet Contributor Guide</a></li>
    
    <li class="breadcrumb-item active" aria-current="page"><span class="ellipsis">Comet Development Guide</span></li>
  </ul>
</nav>
</div>
      
    </div>
  
  
</div>
</div>
              
              
              
                
<div id="searchbox"></div>
                <article class="bd-article">
                  
  <!--
Licensed to the Apache Software Foundation (ASF) under one
or more contributor license agreements.  See the NOTICE file
distributed with this work for additional information
regarding copyright ownership.  The ASF licenses this file
to you under the Apache License, Version 2.0 (the
"License"); you may not use this file except in compliance
with the License.  You may obtain a copy of the License at

  http://www.apache.org/licenses/LICENSE-2.0

Unless required by applicable law or agreed to in writing,
software distributed under the License is distributed on an
"AS IS" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
KIND, either express or implied.  See the License for the
specific language governing permissions and limitations
under the License.
-->
<section id="comet-development-guide">
<h1>Comet Development Guide<a class="headerlink" href="#comet-development-guide" title="Link to this heading">#</a></h1>
<section id="project-layout">
<h2>Project Layout<a class="headerlink" href="#project-layout" title="Link to this heading">#</a></h2>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>├── common     &lt;- common Java/Scala code
├── conf       &lt;- configuration files
├── native     &lt;- native code, in Rust
├── spark      &lt;- Spark integration
</pre></div>
</div>
</section>
<section id="development-setup">
<h2>Development Setup<a class="headerlink" href="#development-setup" title="Link to this heading">#</a></h2>
<ol class="arabic simple">
<li><p>Make sure <code class="docutils literal notranslate"><span class="pre">JAVA_HOME</span></code> is set and point to JDK using <a class="reference internal" href="../user-guide/latest/installation.html"><span class="std std-doc">support matrix</span></a></p></li>
<li><p>Install Rust toolchain. The easiest way is to use
<a class="reference external" href="https://rustup.rs">rustup</a>.</p></li>
</ol>
</section>
<section id="build-test">
<h2>Build &amp; Test<a class="headerlink" href="#build-test" title="Link to this heading">#</a></h2>
<p>A few common commands are specified in project’s <code class="docutils literal notranslate"><span class="pre">Makefile</span></code>:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">make</span></code>: compile the entire project, but don’t run tests</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">make</span> <span class="pre">test-rust</span></code>: compile the project and run tests in Rust side</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">make</span> <span class="pre">test-jvm</span></code>: compile the project and run tests in Java side</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">make</span> <span class="pre">test</span></code>: compile the project and run tests in both Rust and Java
side.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">make</span> <span class="pre">release</span></code>: compile the project and creates a release build. This
is useful when you want to test Comet local installation in another project
such as Spark.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">make</span> <span class="pre">clean</span></code>: clean up the workspace</p></li>
</ul>
</section>
<section id="development-environment">
<h2>Development Environment<a class="headerlink" href="#development-environment" title="Link to this heading">#</a></h2>
<p>Comet is a multi-language project with native code written in Rust and JVM code written in Java and Scala.
For Rust code, the CLion IDE is recommended. For JVM code, IntelliJ IDEA is recommended.</p>
<p>Before opening the project in an IDE, make sure to run <code class="docutils literal notranslate"><span class="pre">make</span></code> first to generate the necessary files for the IDEs. Currently, it’s mostly about
generating protobuf message classes for the JVM side. It’s only required to run <code class="docutils literal notranslate"><span class="pre">make</span></code> once after cloning the repo.</p>
<section id="intellij-idea">
<h3>IntelliJ IDEA<a class="headerlink" href="#intellij-idea" title="Link to this heading">#</a></h3>
<p>First make sure to install the Scala plugin in IntelliJ IDEA.
After that, you can open the project in IntelliJ IDEA. The IDE should automatically detect the project structure and import as a Maven project.</p>
<p>Comet uses generated source files that are too large for IntelliJ’s default size limit for code inspections. To avoid IDE errors
(missing definitions, etc.) caused by IntelliJ skipping these generated files, modify
<a class="reference external" href="https://intellij-support.jetbrains.com/hc/en-us/articles/206544869-Configuring-JVM-options-and-platform-properties">IntelliJ’s Platform Properties</a>
by going to <code class="docutils literal notranslate"><span class="pre">Help</span> <span class="pre">-&gt;</span> <span class="pre">Edit</span> <span class="pre">Custom</span> <span class="pre">Properties...</span></code>. For example, adding <code class="docutils literal notranslate"><span class="pre">idea.max.intellisense.filesize=16384</span></code> increases the file
size limit to 16 MB.</p>
</section>
<section id="clion">
<h3>CLion<a class="headerlink" href="#clion" title="Link to this heading">#</a></h3>
<p>First make sure to install the Rust plugin in CLion or you can use the dedicated Rust IDE: RustRover.
After that you can open the project in CLion. The IDE should automatically detect the project structure and import as a Cargo project.</p>
</section>
<section id="running-tests-in-idea">
<h3>Running Tests in IDEA<a class="headerlink" href="#running-tests-in-idea" title="Link to this heading">#</a></h3>
<p>Like other Maven projects, you can run tests in IntelliJ IDEA by right-clicking on the test class or test method and selecting “Run” or “Debug”.
However if the tests is related to the native side. Please make sure to run <code class="docutils literal notranslate"><span class="pre">make</span> <span class="pre">core</span></code> or <code class="docutils literal notranslate"><span class="pre">cd</span> <span class="pre">native</span> <span class="pre">&amp;&amp;</span> <span class="pre">cargo</span> <span class="pre">build</span></code> before running the tests in IDEA.</p>
</section>
<section id="running-tests-from-command-line">
<h3>Running Tests from command line<a class="headerlink" href="#running-tests-from-command-line" title="Link to this heading">#</a></h3>
<p>It is possible to specify which ScalaTest suites you want to run from the CLI using the <code class="docutils literal notranslate"><span class="pre">suites</span></code>
argument, for example if you only want to execute the test cases that contains <em>valid</em>
in their name in <code class="docutils literal notranslate"><span class="pre">org.apache.comet.CometCastSuite</span></code> you can use</p>
<div class="highlight-sh notranslate"><div class="highlight"><pre><span></span>./mvnw<span class="w"> </span><span class="nb">test</span><span class="w"> </span>-Dtest<span class="o">=</span>none<span class="w"> </span>-Dsuites<span class="o">=</span><span class="s2">&quot;org.apache.comet.CometCastSuite valid&quot;</span>
</pre></div>
</div>
<p>Other options for selecting specific suites are described in the <a class="reference external" href="https://www.scalatest.org/user_guide/using_the_scalatest_maven_plugin">ScalaTest Maven Plugin documentation</a></p>
</section>
</section>
<section id="plan-stability-testing">
<h2>Plan Stability Testing<a class="headerlink" href="#plan-stability-testing" title="Link to this heading">#</a></h2>
<p>Comet has a plan stability testing framework that can be used to test the stability of the query plans generated by Comet.
The plan stability testing framework is located in the <code class="docutils literal notranslate"><span class="pre">spark</span></code> module and can be run using the following commands.</p>
<p>First, Comet needs to be installed for each Spark version to be tested:</p>
<div class="highlight-sh notranslate"><div class="highlight"><pre><span></span>./mvnw<span class="w"> </span>install<span class="w"> </span>-DskipTests<span class="w"> </span>-Pspark-3.4
./mvnw<span class="w"> </span>install<span class="w"> </span>-DskipTests<span class="w"> </span>-Pspark-3.5<span class="w"> </span>
<span class="c1"># note that Spark 4.0 requires JDK 17 or later</span>
./mvnw<span class="w"> </span>install<span class="w"> </span>-DskipTests<span class="w"> </span>-Pspark-4.0
</pre></div>
</div>
<p>Note that the output files get written to <code class="docutils literal notranslate"><span class="pre">$SPARK_HOME</span></code>.</p>
<p>The tests can be run with:</p>
<div class="highlight-sh notranslate"><div class="highlight"><pre><span></span><span class="nb">export</span><span class="w"> </span><span class="nv">SPARK_HOME</span><span class="o">=</span><span class="sb">`</span><span class="nb">pwd</span><span class="sb">`</span>
./mvnw<span class="w"> </span>-pl<span class="w"> </span>spark<span class="w"> </span>-Dsuites<span class="o">=</span><span class="s2">&quot;org.apache.spark.sql.comet.CometTPCDSV1_4_PlanStabilitySuite&quot;</span><span class="w"> </span>-Pspark-3.4<span class="w"> </span>-nsu<span class="w"> </span><span class="nb">test</span>
./mvnw<span class="w"> </span>-pl<span class="w"> </span>spark<span class="w"> </span>-Dsuites<span class="o">=</span><span class="s2">&quot;org.apache.spark.sql.comet.CometTPCDSV1_4_PlanStabilitySuite&quot;</span><span class="w"> </span>-Pspark-3.5<span class="w"> </span>-nsu<span class="w"> </span><span class="nb">test</span>
./mvnw<span class="w"> </span>-pl<span class="w"> </span>spark<span class="w"> </span>-Dsuites<span class="o">=</span><span class="s2">&quot;org.apache.spark.sql.comet.CometTPCDSV1_4_PlanStabilitySuite&quot;</span><span class="w"> </span>-Pspark-4.0<span class="w"> </span>-nsu<span class="w"> </span><span class="nb">test</span>
</pre></div>
</div>
<p>and</p>
<div class="highlight-sh notranslate"><div class="highlight"><pre><span></span><span class="nb">export</span><span class="w"> </span><span class="nv">SPARK_HOME</span><span class="o">=</span><span class="sb">`</span><span class="nb">pwd</span><span class="sb">`</span>
./mvnw<span class="w"> </span>-pl<span class="w"> </span>spark<span class="w"> </span>-Dsuites<span class="o">=</span><span class="s2">&quot;org.apache.spark.sql.comet.CometTPCDSV2_7_PlanStabilitySuite&quot;</span><span class="w"> </span>-Pspark-3.4<span class="w"> </span>-nsu<span class="w"> </span><span class="nb">test</span>
./mvnw<span class="w"> </span>-pl<span class="w"> </span>spark<span class="w"> </span>-Dsuites<span class="o">=</span><span class="s2">&quot;org.apache.spark.sql.comet.CometTPCDSV2_7_PlanStabilitySuite&quot;</span><span class="w"> </span>-Pspark-3.5<span class="w"> </span>-nsu<span class="w"> </span><span class="nb">test</span>
./mvnw<span class="w"> </span>-pl<span class="w"> </span>spark<span class="w"> </span>-Dsuites<span class="o">=</span><span class="s2">&quot;org.apache.spark.sql.comet.CometTPCDSV2_7_PlanStabilitySuite&quot;</span><span class="w"> </span>-Pspark-4.0<span class="w"> </span>-nsu<span class="w"> </span><span class="nb">test</span>
</pre></div>
</div>
<p>If your pull request changes the query plans generated by Comet, you should regenerate the golden files.
To regenerate the golden files, you can run the following commands.</p>
<div class="highlight-sh notranslate"><div class="highlight"><pre><span></span><span class="nb">export</span><span class="w"> </span><span class="nv">SPARK_HOME</span><span class="o">=</span><span class="sb">`</span><span class="nb">pwd</span><span class="sb">`</span>
<span class="nv">SPARK_GENERATE_GOLDEN_FILES</span><span class="o">=</span><span class="m">1</span><span class="w"> </span>./mvnw<span class="w"> </span>-pl<span class="w"> </span>spark<span class="w"> </span>-Dsuites<span class="o">=</span><span class="s2">&quot;org.apache.spark.sql.comet.CometTPCDSV1_4_PlanStabilitySuite&quot;</span><span class="w"> </span>-Pspark-3.4<span class="w"> </span>-nsu<span class="w"> </span><span class="nb">test</span>
<span class="nv">SPARK_GENERATE_GOLDEN_FILES</span><span class="o">=</span><span class="m">1</span><span class="w"> </span>./mvnw<span class="w"> </span>-pl<span class="w"> </span>spark<span class="w"> </span>-Dsuites<span class="o">=</span><span class="s2">&quot;org.apache.spark.sql.comet.CometTPCDSV1_4_PlanStabilitySuite&quot;</span><span class="w"> </span>-Pspark-3.5<span class="w"> </span>-nsu<span class="w"> </span><span class="nb">test</span>
<span class="nv">SPARK_GENERATE_GOLDEN_FILES</span><span class="o">=</span><span class="m">1</span><span class="w"> </span>./mvnw<span class="w"> </span>-pl<span class="w"> </span>spark<span class="w"> </span>-Dsuites<span class="o">=</span><span class="s2">&quot;org.apache.spark.sql.comet.CometTPCDSV1_4_PlanStabilitySuite&quot;</span><span class="w"> </span>-Pspark-4.0<span class="w"> </span>-nsu<span class="w"> </span><span class="nb">test</span>
</pre></div>
</div>
<p>and</p>
<div class="highlight-sh notranslate"><div class="highlight"><pre><span></span><span class="nb">export</span><span class="w"> </span><span class="nv">SPARK_HOME</span><span class="o">=</span><span class="sb">`</span><span class="nb">pwd</span><span class="sb">`</span>
<span class="nv">SPARK_GENERATE_GOLDEN_FILES</span><span class="o">=</span><span class="m">1</span><span class="w"> </span>./mvnw<span class="w"> </span>-pl<span class="w"> </span>spark<span class="w"> </span>-Dsuites<span class="o">=</span><span class="s2">&quot;org.apache.spark.sql.comet.CometTPCDSV2_7_PlanStabilitySuite&quot;</span><span class="w"> </span>-Pspark-3.4<span class="w"> </span>-nsu<span class="w"> </span><span class="nb">test</span>
<span class="nv">SPARK_GENERATE_GOLDEN_FILES</span><span class="o">=</span><span class="m">1</span><span class="w"> </span>./mvnw<span class="w"> </span>-pl<span class="w"> </span>spark<span class="w"> </span>-Dsuites<span class="o">=</span><span class="s2">&quot;org.apache.spark.sql.comet.CometTPCDSV2_7_PlanStabilitySuite&quot;</span><span class="w"> </span>-Pspark-3.5<span class="w"> </span>-nsu<span class="w"> </span><span class="nb">test</span>
<span class="nv">SPARK_GENERATE_GOLDEN_FILES</span><span class="o">=</span><span class="m">1</span><span class="w"> </span>./mvnw<span class="w"> </span>-pl<span class="w"> </span>spark<span class="w"> </span>-Dsuites<span class="o">=</span><span class="s2">&quot;org.apache.spark.sql.comet.CometTPCDSV2_7_PlanStabilitySuite&quot;</span><span class="w"> </span>-Pspark-4.0<span class="w"> </span>-nsu<span class="w"> </span><span class="nb">test</span>
</pre></div>
</div>
</section>
<section id="benchmark">
<h2>Benchmark<a class="headerlink" href="#benchmark" title="Link to this heading">#</a></h2>
<p>There’s a <code class="docutils literal notranslate"><span class="pre">make</span></code> command to run micro benchmarks in the repo. For
instance:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">make</span> <span class="n">benchmark</span><span class="o">-</span><span class="n">org</span><span class="o">.</span><span class="n">apache</span><span class="o">.</span><span class="n">spark</span><span class="o">.</span><span class="n">sql</span><span class="o">.</span><span class="n">benchmark</span><span class="o">.</span><span class="n">CometReadBenchmark</span>
</pre></div>
</div>
<p>To run TPC-H or TPC-DS micro benchmarks, please follow the instructions
in the respective source code, e.g., <code class="docutils literal notranslate"><span class="pre">CometTPCHQueryBenchmark</span></code>.</p>
</section>
<section id="debugging">
<h2>Debugging<a class="headerlink" href="#debugging" title="Link to this heading">#</a></h2>
<p>Comet is a multi-language project with native code written in Rust and JVM code written in Java and Scala.
It is possible to debug both native and JVM code concurrently as described in the <a class="reference internal" href="debugging.html"><span class="doc std std-doc">DEBUGGING guide</span></a></p>
</section>
<section id="submitting-a-pull-request">
<h2>Submitting a Pull Request<a class="headerlink" href="#submitting-a-pull-request" title="Link to this heading">#</a></h2>
<p>Comet uses <code class="docutils literal notranslate"><span class="pre">cargo</span> <span class="pre">fmt</span></code>, <a class="reference external" href="https://github.com/scalacenter/scalafix">Scalafix</a> and <a class="reference external" href="https://github.com/diffplug/spotless/tree/main/plugin-maven">Spotless</a> to
automatically format the code. Before submitting a pull request, you can simply run <code class="docutils literal notranslate"><span class="pre">make</span> <span class="pre">format</span></code> to format the code.</p>
<p>Additionally, it’s strongly recommended to run Clippy locally to catch potential issues before the CI/CD pipeline does. You can run the same Clippy checks used in CI/CD with:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="nb">cd</span><span class="w"> </span>native
cargo<span class="w"> </span>clippy<span class="w"> </span>--color<span class="o">=</span>never<span class="w"> </span>--all-targets<span class="w"> </span>--workspace<span class="w"> </span>--<span class="w"> </span>-D<span class="w"> </span>warnings
</pre></div>
</div>
<p>Make sure to resolve any Clippy warnings before submitting your pull request, as the CI/CD pipeline will fail if warnings are present.</p>
</section>
</section>


                </article>
              
              
              
              
              
                <footer class="prev-next-footer d-print-none">
                  
<div class="prev-next-area">
    <a class="left-prev"
       href="plugin_overview.html"
       title="previous page">
      <i class="fa-solid fa-angle-left"></i>
      <div class="prev-next-info">
        <p class="prev-next-subtitle">previous</p>
        <p class="prev-next-title">Comet Plugin Architecture</p>
      </div>
    </a>
    <a class="right-next"
       href="debugging.html"
       title="next page">
      <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title">Comet Debugging Guide</p>
      </div>
      <i class="fa-solid fa-angle-right"></i>
    </a>
</div>
                </footer>
              
            </div>
            
            
              
            
          </div>
          <footer class="bd-footer-content">
            
          </footer>
        
      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script defer src="../_static/scripts/bootstrap.js?digest=8878045cc6db502f8baf"></script>
<script defer src="../_static/scripts/pydata-sphinx-theme.js?digest=8878045cc6db502f8baf"></script>

<!-- Based on pydata_sphinx_theme/footer.html -->
<footer class="footer mt-5 mt-md-0">
  <div class="container">
    
    <div class="footer-item">
      <p>Apache DataFusion, Apache DataFusion Comet, Apache, the Apache feather logo, and the Apache DataFusion project logo</p>
      <p>are either registered trademarks or trademarks of The Apache Software Foundation in the United States and other countries.</p>
    </div>
  </div>
</footer>


  </body>
</html>