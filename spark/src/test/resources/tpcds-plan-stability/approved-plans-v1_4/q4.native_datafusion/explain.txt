== Physical Plan ==
* CometColumnarToRow (115)
+- CometTakeOrderedAndProject (114)
   +- CometProject (113)
      +- CometBroadcastHashJoin (112)
         :- CometProject (94)
         :  +- CometBroadcastHashJoin (93)
         :     :- CometProject (74)
         :     :  +- CometBroadcastHashJoin (73)
         :     :     :- CometProject (55)
         :     :     :  +- CometBroadcastHashJoin (54)
         :     :     :     :- CometBroadcastHashJoin (35)
         :     :     :     :  :- CometFilter (17)
         :     :     :     :  :  +- CometHashAggregate (16)
         :     :     :     :  :     +- CometColumnarExchange (15)
         :     :     :     :  :        +- * HashAggregate (14)
         :     :     :     :  :           +- * Project (13)
         :     :     :     :  :              +- * BroadcastHashJoin Inner BuildRight (12)
         :     :     :     :  :                 :- * Project (10)
         :     :     :     :  :                 :  +- * BroadcastHashJoin Inner BuildRight (9)
         :     :     :     :  :                 :     :- * CometColumnarToRow (4)
         :     :     :     :  :                 :     :  +- CometProject (3)
         :     :     :     :  :                 :     :     +- CometFilter (2)
         :     :     :     :  :                 :     :        +- CometNativeScan parquet spark_catalog.default.customer (1)
         :     :     :     :  :                 :     +- BroadcastExchange (8)
         :     :     :     :  :                 :        +- * Filter (7)
         :     :     :     :  :                 :           +- * ColumnarToRow (6)
         :     :     :     :  :                 :              +- Scan parquet spark_catalog.default.store_sales (5)
         :     :     :     :  :                 +- ReusedExchange (11)
         :     :     :     :  +- CometBroadcastExchange (34)
         :     :     :     :     +- CometHashAggregate (33)
         :     :     :     :        +- CometColumnarExchange (32)
         :     :     :     :           +- * HashAggregate (31)
         :     :     :     :              +- * Project (30)
         :     :     :     :                 +- * BroadcastHashJoin Inner BuildRight (29)
         :     :     :     :                    :- * Project (27)
         :     :     :     :                    :  +- * BroadcastHashJoin Inner BuildRight (26)
         :     :     :     :                    :     :- * CometColumnarToRow (21)
         :     :     :     :                    :     :  +- CometProject (20)
         :     :     :     :                    :     :     +- CometFilter (19)
         :     :     :     :                    :     :        +- CometNativeScan parquet spark_catalog.default.customer (18)
         :     :     :     :                    :     +- BroadcastExchange (25)
         :     :     :     :                    :        +- * Filter (24)
         :     :     :     :                    :           +- * ColumnarToRow (23)
         :     :     :     :                    :              +- Scan parquet spark_catalog.default.store_sales (22)
         :     :     :     :                    +- ReusedExchange (28)
         :     :     :     +- CometBroadcastExchange (53)
         :     :     :        +- CometFilter (52)
         :     :     :           +- CometHashAggregate (51)
         :     :     :              +- CometColumnarExchange (50)
         :     :     :                 +- * HashAggregate (49)
         :     :     :                    +- * Project (48)
         :     :     :                       +- * BroadcastHashJoin Inner BuildRight (47)
         :     :     :                          :- * Project (45)
         :     :     :                          :  +- * BroadcastHashJoin Inner BuildRight (44)
         :     :     :                          :     :- * CometColumnarToRow (39)
         :     :     :                          :     :  +- CometProject (38)
         :     :     :                          :     :     +- CometFilter (37)
         :     :     :                          :     :        +- CometNativeScan parquet spark_catalog.default.customer (36)
         :     :     :                          :     +- BroadcastExchange (43)
         :     :     :                          :        +- * Filter (42)
         :     :     :                          :           +- * ColumnarToRow (41)
         :     :     :                          :              +- Scan parquet spark_catalog.default.catalog_sales (40)
         :     :     :                          +- ReusedExchange (46)
         :     :     +- CometBroadcastExchange (72)
         :     :        +- CometHashAggregate (71)
         :     :           +- CometColumnarExchange (70)
         :     :              +- * HashAggregate (69)
         :     :                 +- * Project (68)
         :     :                    +- * BroadcastHashJoin Inner BuildRight (67)
         :     :                       :- * Project (65)
         :     :                       :  +- * BroadcastHashJoin Inner BuildRight (64)
         :     :                       :     :- * CometColumnarToRow (59)
         :     :                       :     :  +- CometProject (58)
         :     :                       :     :     +- CometFilter (57)
         :     :                       :     :        +- CometNativeScan parquet spark_catalog.default.customer (56)
         :     :                       :     +- BroadcastExchange (63)
         :     :                       :        +- * Filter (62)
         :     :                       :           +- * ColumnarToRow (61)
         :     :                       :              +- Scan parquet spark_catalog.default.catalog_sales (60)
         :     :                       +- ReusedExchange (66)
         :     +- CometBroadcastExchange (92)
         :        +- CometFilter (91)
         :           +- CometHashAggregate (90)
         :              +- CometColumnarExchange (89)
         :                 +- * HashAggregate (88)
         :                    +- * Project (87)
         :                       +- * BroadcastHashJoin Inner BuildRight (86)
         :                          :- * Project (84)
         :                          :  +- * BroadcastHashJoin Inner BuildRight (83)
         :                          :     :- * CometColumnarToRow (78)
         :                          :     :  +- CometProject (77)
         :                          :     :     +- CometFilter (76)
         :                          :     :        +- CometNativeScan parquet spark_catalog.default.customer (75)
         :                          :     +- BroadcastExchange (82)
         :                          :        +- * Filter (81)
         :                          :           +- * ColumnarToRow (80)
         :                          :              +- Scan parquet spark_catalog.default.web_sales (79)
         :                          +- ReusedExchange (85)
         +- CometBroadcastExchange (111)
            +- CometHashAggregate (110)
               +- CometColumnarExchange (109)
                  +- * HashAggregate (108)
                     +- * Project (107)
                        +- * BroadcastHashJoin Inner BuildRight (106)
                           :- * Project (104)
                           :  +- * BroadcastHashJoin Inner BuildRight (103)
                           :     :- * CometColumnarToRow (98)
                           :     :  +- CometProject (97)
                           :     :     +- CometFilter (96)
                           :     :        +- CometNativeScan parquet spark_catalog.default.customer (95)
                           :     +- BroadcastExchange (102)
                           :        +- * Filter (101)
                           :           +- * ColumnarToRow (100)
                           :              +- Scan parquet spark_catalog.default.web_sales (99)
                           +- ReusedExchange (105)


(1) CometNativeScan parquet spark_catalog.default.customer
Output [8]: [c_customer_sk#1, c_customer_id#2, c_first_name#3, c_last_name#4, c_preferred_cust_flag#5, c_birth_country#6, c_login#7, c_email_address#8]
Batched: true
Location [not included in comparison]/{warehouse_dir}/customer]
PushedFilters: [IsNotNull(c_customer_sk)]
ReadSchema: struct<c_customer_sk:int,c_customer_id:string,c_first_name:string,c_last_name:string,c_preferred_cust_flag:string,c_birth_country:string,c_login:string,c_email_address:string>

(2) CometFilter
Input [8]: [c_customer_sk#1, c_customer_id#2, c_first_name#3, c_last_name#4, c_preferred_cust_flag#5, c_birth_country#6, c_login#7, c_email_address#8]
Condition : (isnotnull(c_customer_sk#1) AND isnotnull(staticinvoke(class org.apache.spark.sql.catalyst.util.CharVarcharCodegenUtils, StringType, readSidePadding, c_customer_id#2, 16, true, false, true)))

(3) CometProject
Input [8]: [c_customer_sk#1, c_customer_id#2, c_first_name#3, c_last_name#4, c_preferred_cust_flag#5, c_birth_country#6, c_login#7, c_email_address#8]
Arguments: [c_customer_sk#1, c_customer_id#9, c_first_name#10, c_last_name#11, c_preferred_cust_flag#12, c_birth_country#6, c_login#13, c_email_address#14], [c_customer_sk#1, staticinvoke(class org.apache.spark.sql.catalyst.util.CharVarcharCodegenUtils, StringType, readSidePadding, c_customer_id#2, 16, true, false, true) AS c_customer_id#9, staticinvoke(class org.apache.spark.sql.catalyst.util.CharVarcharCodegenUtils, StringType, readSidePadding, c_first_name#3, 20, true, false, true) AS c_first_name#10, staticinvoke(class org.apache.spark.sql.catalyst.util.CharVarcharCodegenUtils, StringType, readSidePadding, c_last_name#4, 30, true, false, true) AS c_last_name#11, staticinvoke(class org.apache.spark.sql.catalyst.util.CharVarcharCodegenUtils, StringType, readSidePadding, c_preferred_cust_flag#5, 1, true, false, true) AS c_preferred_cust_flag#12, c_birth_country#6, staticinvoke(class org.apache.spark.sql.catalyst.util.CharVarcharCodegenUtils, StringType, readSidePadding, c_login#7, 13, true, false, true) AS c_login#13, staticinvoke(class org.apache.spark.sql.catalyst.util.CharVarcharCodegenUtils, StringType, readSidePadding, c_email_address#8, 50, true, false, true) AS c_email_address#14]

(4) CometColumnarToRow [codegen id : 3]
Input [8]: [c_customer_sk#1, c_customer_id#9, c_first_name#10, c_last_name#11, c_preferred_cust_flag#12, c_birth_country#6, c_login#13, c_email_address#14]

(5) Scan parquet spark_catalog.default.store_sales
Output [6]: [ss_customer_sk#15, ss_ext_discount_amt#16, ss_ext_sales_price#17, ss_ext_wholesale_cost#18, ss_ext_list_price#19, ss_sold_date_sk#20]
Batched: true
Location: InMemoryFileIndex []
PartitionFilters: [isnotnull(ss_sold_date_sk#20), dynamicpruningexpression(ss_sold_date_sk#20 IN dynamicpruning#21)]
PushedFilters: [IsNotNull(ss_customer_sk)]
ReadSchema: struct<ss_customer_sk:int,ss_ext_discount_amt:decimal(7,2),ss_ext_sales_price:decimal(7,2),ss_ext_wholesale_cost:decimal(7,2),ss_ext_list_price:decimal(7,2)>

(6) ColumnarToRow [codegen id : 1]
Input [6]: [ss_customer_sk#15, ss_ext_discount_amt#16, ss_ext_sales_price#17, ss_ext_wholesale_cost#18, ss_ext_list_price#19, ss_sold_date_sk#20]

(7) Filter [codegen id : 1]
Input [6]: [ss_customer_sk#15, ss_ext_discount_amt#16, ss_ext_sales_price#17, ss_ext_wholesale_cost#18, ss_ext_list_price#19, ss_sold_date_sk#20]
Condition : isnotnull(ss_customer_sk#15)

(8) BroadcastExchange
Input [6]: [ss_customer_sk#15, ss_ext_discount_amt#16, ss_ext_sales_price#17, ss_ext_wholesale_cost#18, ss_ext_list_price#19, ss_sold_date_sk#20]
Arguments: HashedRelationBroadcastMode(List(cast(input[0, int, false] as bigint)),false), [plan_id=1]

(9) BroadcastHashJoin [codegen id : 3]
Left keys [1]: [c_customer_sk#1]
Right keys [1]: [ss_customer_sk#15]
Join type: Inner
Join condition: None

(10) Project [codegen id : 3]
Output [12]: [c_customer_id#9, c_first_name#10, c_last_name#11, c_preferred_cust_flag#12, c_birth_country#6, c_login#13, c_email_address#14, ss_ext_discount_amt#16, ss_ext_sales_price#17, ss_ext_wholesale_cost#18, ss_ext_list_price#19, ss_sold_date_sk#20]
Input [14]: [c_customer_sk#1, c_customer_id#9, c_first_name#10, c_last_name#11, c_preferred_cust_flag#12, c_birth_country#6, c_login#13, c_email_address#14, ss_customer_sk#15, ss_ext_discount_amt#16, ss_ext_sales_price#17, ss_ext_wholesale_cost#18, ss_ext_list_price#19, ss_sold_date_sk#20]

(11) ReusedExchange [Reuses operator id: 119]
Output [2]: [d_date_sk#22, d_year#23]

(12) BroadcastHashJoin [codegen id : 3]
Left keys [1]: [ss_sold_date_sk#20]
Right keys [1]: [d_date_sk#22]
Join type: Inner
Join condition: None

(13) Project [codegen id : 3]
Output [12]: [c_customer_id#9, c_first_name#10, c_last_name#11, c_preferred_cust_flag#12, c_birth_country#6, c_login#13, c_email_address#14, ss_ext_discount_amt#16, ss_ext_sales_price#17, ss_ext_wholesale_cost#18, ss_ext_list_price#19, d_year#23]
Input [14]: [c_customer_id#9, c_first_name#10, c_last_name#11, c_preferred_cust_flag#12, c_birth_country#6, c_login#13, c_email_address#14, ss_ext_discount_amt#16, ss_ext_sales_price#17, ss_ext_wholesale_cost#18, ss_ext_list_price#19, ss_sold_date_sk#20, d_date_sk#22, d_year#23]

(14) HashAggregate [codegen id : 3]
Input [12]: [c_customer_id#9, c_first_name#10, c_last_name#11, c_preferred_cust_flag#12, c_birth_country#6, c_login#13, c_email_address#14, ss_ext_discount_amt#16, ss_ext_sales_price#17, ss_ext_wholesale_cost#18, ss_ext_list_price#19, d_year#23]
Keys [8]: [c_customer_id#9, c_first_name#10, c_last_name#11, c_preferred_cust_flag#12, c_birth_country#6, c_login#13, c_email_address#14, d_year#23]
Functions [1]: [partial_sum(((((ss_ext_list_price#19 - ss_ext_wholesale_cost#18) - ss_ext_discount_amt#16) + ss_ext_sales_price#17) / 2))]
Aggregate Attributes [2]: [sum#24, isEmpty#25]
Results [10]: [c_customer_id#9, c_first_name#10, c_last_name#11, c_preferred_cust_flag#12, c_birth_country#6, c_login#13, c_email_address#14, d_year#23, sum#26, isEmpty#27]

(15) CometColumnarExchange
Input [10]: [c_customer_id#9, c_first_name#10, c_last_name#11, c_preferred_cust_flag#12, c_birth_country#6, c_login#13, c_email_address#14, d_year#23, sum#26, isEmpty#27]
Arguments: hashpartitioning(c_customer_id#9, c_first_name#10, c_last_name#11, c_preferred_cust_flag#12, c_birth_country#6, c_login#13, c_email_address#14, d_year#23, 5), ENSURE_REQUIREMENTS, CometColumnarShuffle, [plan_id=2]

(16) CometHashAggregate
Input [10]: [c_customer_id#9, c_first_name#10, c_last_name#11, c_preferred_cust_flag#12, c_birth_country#6, c_login#13, c_email_address#14, d_year#23, sum#26, isEmpty#27]
Keys [8]: [c_customer_id#9, c_first_name#10, c_last_name#11, c_preferred_cust_flag#12, c_birth_country#6, c_login#13, c_email_address#14, d_year#23]
Functions [1]: [sum(((((ss_ext_list_price#19 - ss_ext_wholesale_cost#18) - ss_ext_discount_amt#16) + ss_ext_sales_price#17) / 2))]

(17) CometFilter
Input [2]: [customer_id#28, year_total#29]
Condition : (isnotnull(year_total#29) AND (year_total#29 > 0.000000))

(18) CometNativeScan parquet spark_catalog.default.customer
Output [8]: [c_customer_sk#30, c_customer_id#31, c_first_name#32, c_last_name#33, c_preferred_cust_flag#34, c_birth_country#35, c_login#36, c_email_address#37]
Batched: true
Location [not included in comparison]/{warehouse_dir}/customer]
PushedFilters: [IsNotNull(c_customer_sk)]
ReadSchema: struct<c_customer_sk:int,c_customer_id:string,c_first_name:string,c_last_name:string,c_preferred_cust_flag:string,c_birth_country:string,c_login:string,c_email_address:string>

(19) CometFilter
Input [8]: [c_customer_sk#30, c_customer_id#31, c_first_name#32, c_last_name#33, c_preferred_cust_flag#34, c_birth_country#35, c_login#36, c_email_address#37]
Condition : (isnotnull(c_customer_sk#30) AND isnotnull(staticinvoke(class org.apache.spark.sql.catalyst.util.CharVarcharCodegenUtils, StringType, readSidePadding, c_customer_id#31, 16, true, false, true)))

(20) CometProject
Input [8]: [c_customer_sk#30, c_customer_id#31, c_first_name#32, c_last_name#33, c_preferred_cust_flag#34, c_birth_country#35, c_login#36, c_email_address#37]
Arguments: [c_customer_sk#30, c_customer_id#9, c_first_name#10, c_last_name#11, c_preferred_cust_flag#12, c_birth_country#35, c_login#13, c_email_address#14], [c_customer_sk#30, staticinvoke(class org.apache.spark.sql.catalyst.util.CharVarcharCodegenUtils, StringType, readSidePadding, c_customer_id#31, 16, true, false, true) AS c_customer_id#9, staticinvoke(class org.apache.spark.sql.catalyst.util.CharVarcharCodegenUtils, StringType, readSidePadding, c_first_name#32, 20, true, false, true) AS c_first_name#10, staticinvoke(class org.apache.spark.sql.catalyst.util.CharVarcharCodegenUtils, StringType, readSidePadding, c_last_name#33, 30, true, false, true) AS c_last_name#11, staticinvoke(class org.apache.spark.sql.catalyst.util.CharVarcharCodegenUtils, StringType, readSidePadding, c_preferred_cust_flag#34, 1, true, false, true) AS c_preferred_cust_flag#12, c_birth_country#35, staticinvoke(class org.apache.spark.sql.catalyst.util.CharVarcharCodegenUtils, StringType, readSidePadding, c_login#36, 13, true, false, true) AS c_login#13, staticinvoke(class org.apache.spark.sql.catalyst.util.CharVarcharCodegenUtils, StringType, readSidePadding, c_email_address#37, 50, true, false, true) AS c_email_address#14]

(21) CometColumnarToRow [codegen id : 6]
Input [8]: [c_customer_sk#30, c_customer_id#9, c_first_name#10, c_last_name#11, c_preferred_cust_flag#12, c_birth_country#35, c_login#13, c_email_address#14]

(22) Scan parquet spark_catalog.default.store_sales
Output [6]: [ss_customer_sk#38, ss_ext_discount_amt#39, ss_ext_sales_price#40, ss_ext_wholesale_cost#41, ss_ext_list_price#42, ss_sold_date_sk#43]
Batched: true
Location: InMemoryFileIndex []
PartitionFilters: [isnotnull(ss_sold_date_sk#43), dynamicpruningexpression(ss_sold_date_sk#43 IN dynamicpruning#44)]
PushedFilters: [IsNotNull(ss_customer_sk)]
ReadSchema: struct<ss_customer_sk:int,ss_ext_discount_amt:decimal(7,2),ss_ext_sales_price:decimal(7,2),ss_ext_wholesale_cost:decimal(7,2),ss_ext_list_price:decimal(7,2)>

(23) ColumnarToRow [codegen id : 4]
Input [6]: [ss_customer_sk#38, ss_ext_discount_amt#39, ss_ext_sales_price#40, ss_ext_wholesale_cost#41, ss_ext_list_price#42, ss_sold_date_sk#43]

(24) Filter [codegen id : 4]
Input [6]: [ss_customer_sk#38, ss_ext_discount_amt#39, ss_ext_sales_price#40, ss_ext_wholesale_cost#41, ss_ext_list_price#42, ss_sold_date_sk#43]
Condition : isnotnull(ss_customer_sk#38)

(25) BroadcastExchange
Input [6]: [ss_customer_sk#38, ss_ext_discount_amt#39, ss_ext_sales_price#40, ss_ext_wholesale_cost#41, ss_ext_list_price#42, ss_sold_date_sk#43]
Arguments: HashedRelationBroadcastMode(List(cast(input[0, int, false] as bigint)),false), [plan_id=3]

(26) BroadcastHashJoin [codegen id : 6]
Left keys [1]: [c_customer_sk#30]
Right keys [1]: [ss_customer_sk#38]
Join type: Inner
Join condition: None

(27) Project [codegen id : 6]
Output [12]: [c_customer_id#9, c_first_name#10, c_last_name#11, c_preferred_cust_flag#12, c_birth_country#35, c_login#13, c_email_address#14, ss_ext_discount_amt#39, ss_ext_sales_price#40, ss_ext_wholesale_cost#41, ss_ext_list_price#42, ss_sold_date_sk#43]
Input [14]: [c_customer_sk#30, c_customer_id#9, c_first_name#10, c_last_name#11, c_preferred_cust_flag#12, c_birth_country#35, c_login#13, c_email_address#14, ss_customer_sk#38, ss_ext_discount_amt#39, ss_ext_sales_price#40, ss_ext_wholesale_cost#41, ss_ext_list_price#42, ss_sold_date_sk#43]

(28) ReusedExchange [Reuses operator id: 123]
Output [2]: [d_date_sk#45, d_year#46]

(29) BroadcastHashJoin [codegen id : 6]
Left keys [1]: [ss_sold_date_sk#43]
Right keys [1]: [d_date_sk#45]
Join type: Inner
Join condition: None

(30) Project [codegen id : 6]
Output [12]: [c_customer_id#9, c_first_name#10, c_last_name#11, c_preferred_cust_flag#12, c_birth_country#35, c_login#13, c_email_address#14, ss_ext_discount_amt#39, ss_ext_sales_price#40, ss_ext_wholesale_cost#41, ss_ext_list_price#42, d_year#46]
Input [14]: [c_customer_id#9, c_first_name#10, c_last_name#11, c_preferred_cust_flag#12, c_birth_country#35, c_login#13, c_email_address#14, ss_ext_discount_amt#39, ss_ext_sales_price#40, ss_ext_wholesale_cost#41, ss_ext_list_price#42, ss_sold_date_sk#43, d_date_sk#45, d_year#46]

(31) HashAggregate [codegen id : 6]
Input [12]: [c_customer_id#9, c_first_name#10, c_last_name#11, c_preferred_cust_flag#12, c_birth_country#35, c_login#13, c_email_address#14, ss_ext_discount_amt#39, ss_ext_sales_price#40, ss_ext_wholesale_cost#41, ss_ext_list_price#42, d_year#46]
Keys [8]: [c_customer_id#9, c_first_name#10, c_last_name#11, c_preferred_cust_flag#12, c_birth_country#35, c_login#13, c_email_address#14, d_year#46]
Functions [1]: [partial_sum(((((ss_ext_list_price#42 - ss_ext_wholesale_cost#41) - ss_ext_discount_amt#39) + ss_ext_sales_price#40) / 2))]
Aggregate Attributes [2]: [sum#47, isEmpty#48]
Results [10]: [c_customer_id#9, c_first_name#10, c_last_name#11, c_preferred_cust_flag#12, c_birth_country#35, c_login#13, c_email_address#14, d_year#46, sum#49, isEmpty#50]

(32) CometColumnarExchange
Input [10]: [c_customer_id#9, c_first_name#10, c_last_name#11, c_preferred_cust_flag#12, c_birth_country#35, c_login#13, c_email_address#14, d_year#46, sum#49, isEmpty#50]
Arguments: hashpartitioning(c_customer_id#9, c_first_name#10, c_last_name#11, c_preferred_cust_flag#12, c_birth_country#35, c_login#13, c_email_address#14, d_year#46, 5), ENSURE_REQUIREMENTS, CometColumnarShuffle, [plan_id=4]

(33) CometHashAggregate
Input [10]: [c_customer_id#9, c_first_name#10, c_last_name#11, c_preferred_cust_flag#12, c_birth_country#35, c_login#13, c_email_address#14, d_year#46, sum#49, isEmpty#50]
Keys [8]: [c_customer_id#9, c_first_name#10, c_last_name#11, c_preferred_cust_flag#12, c_birth_country#35, c_login#13, c_email_address#14, d_year#46]
Functions [1]: [sum(((((ss_ext_list_price#42 - ss_ext_wholesale_cost#41) - ss_ext_discount_amt#39) + ss_ext_sales_price#40) / 2))]

(34) CometBroadcastExchange
Input [8]: [customer_id#51, customer_first_name#52, customer_last_name#53, customer_preferred_cust_flag#54, customer_birth_country#55, customer_login#56, customer_email_address#57, year_total#58]
Arguments: [customer_id#51, customer_first_name#52, customer_last_name#53, customer_preferred_cust_flag#54, customer_birth_country#55, customer_login#56, customer_email_address#57, year_total#58]

(35) CometBroadcastHashJoin
Left output [2]: [customer_id#28, year_total#29]
Right output [8]: [customer_id#51, customer_first_name#52, customer_last_name#53, customer_preferred_cust_flag#54, customer_birth_country#55, customer_login#56, customer_email_address#57, year_total#58]
Arguments: [customer_id#28], [customer_id#51], Inner, BuildRight

(36) CometNativeScan parquet spark_catalog.default.customer
Output [8]: [c_customer_sk#59, c_customer_id#60, c_first_name#61, c_last_name#62, c_preferred_cust_flag#63, c_birth_country#64, c_login#65, c_email_address#66]
Batched: true
Location [not included in comparison]/{warehouse_dir}/customer]
PushedFilters: [IsNotNull(c_customer_sk)]
ReadSchema: struct<c_customer_sk:int,c_customer_id:string,c_first_name:string,c_last_name:string,c_preferred_cust_flag:string,c_birth_country:string,c_login:string,c_email_address:string>

(37) CometFilter
Input [8]: [c_customer_sk#59, c_customer_id#60, c_first_name#61, c_last_name#62, c_preferred_cust_flag#63, c_birth_country#64, c_login#65, c_email_address#66]
Condition : (isnotnull(c_customer_sk#59) AND isnotnull(staticinvoke(class org.apache.spark.sql.catalyst.util.CharVarcharCodegenUtils, StringType, readSidePadding, c_customer_id#60, 16, true, false, true)))

(38) CometProject
Input [8]: [c_customer_sk#59, c_customer_id#60, c_first_name#61, c_last_name#62, c_preferred_cust_flag#63, c_birth_country#64, c_login#65, c_email_address#66]
Arguments: [c_customer_sk#59, c_customer_id#67, c_first_name#68, c_last_name#69, c_preferred_cust_flag#70, c_birth_country#64, c_login#71, c_email_address#72], [c_customer_sk#59, staticinvoke(class org.apache.spark.sql.catalyst.util.CharVarcharCodegenUtils, StringType, readSidePadding, c_customer_id#60, 16, true, false, true) AS c_customer_id#67, staticinvoke(class org.apache.spark.sql.catalyst.util.CharVarcharCodegenUtils, StringType, readSidePadding, c_first_name#61, 20, true, false, true) AS c_first_name#68, staticinvoke(class org.apache.spark.sql.catalyst.util.CharVarcharCodegenUtils, StringType, readSidePadding, c_last_name#62, 30, true, false, true) AS c_last_name#69, staticinvoke(class org.apache.spark.sql.catalyst.util.CharVarcharCodegenUtils, StringType, readSidePadding, c_preferred_cust_flag#63, 1, true, false, true) AS c_preferred_cust_flag#70, c_birth_country#64, staticinvoke(class org.apache.spark.sql.catalyst.util.CharVarcharCodegenUtils, StringType, readSidePadding, c_login#65, 13, true, false, true) AS c_login#71, staticinvoke(class org.apache.spark.sql.catalyst.util.CharVarcharCodegenUtils, StringType, readSidePadding, c_email_address#66, 50, true, false, true) AS c_email_address#72]

(39) CometColumnarToRow [codegen id : 9]
Input [8]: [c_customer_sk#59, c_customer_id#67, c_first_name#68, c_last_name#69, c_preferred_cust_flag#70, c_birth_country#64, c_login#71, c_email_address#72]

(40) Scan parquet spark_catalog.default.catalog_sales
Output [6]: [cs_bill_customer_sk#73, cs_ext_discount_amt#74, cs_ext_sales_price#75, cs_ext_wholesale_cost#76, cs_ext_list_price#77, cs_sold_date_sk#78]
Batched: true
Location: InMemoryFileIndex []
PartitionFilters: [isnotnull(cs_sold_date_sk#78), dynamicpruningexpression(cs_sold_date_sk#78 IN dynamicpruning#21)]
PushedFilters: [IsNotNull(cs_bill_customer_sk)]
ReadSchema: struct<cs_bill_customer_sk:int,cs_ext_discount_amt:decimal(7,2),cs_ext_sales_price:decimal(7,2),cs_ext_wholesale_cost:decimal(7,2),cs_ext_list_price:decimal(7,2)>

(41) ColumnarToRow [codegen id : 7]
Input [6]: [cs_bill_customer_sk#73, cs_ext_discount_amt#74, cs_ext_sales_price#75, cs_ext_wholesale_cost#76, cs_ext_list_price#77, cs_sold_date_sk#78]

(42) Filter [codegen id : 7]
Input [6]: [cs_bill_customer_sk#73, cs_ext_discount_amt#74, cs_ext_sales_price#75, cs_ext_wholesale_cost#76, cs_ext_list_price#77, cs_sold_date_sk#78]
Condition : isnotnull(cs_bill_customer_sk#73)

(43) BroadcastExchange
Input [6]: [cs_bill_customer_sk#73, cs_ext_discount_amt#74, cs_ext_sales_price#75, cs_ext_wholesale_cost#76, cs_ext_list_price#77, cs_sold_date_sk#78]
Arguments: HashedRelationBroadcastMode(List(cast(input[0, int, false] as bigint)),false), [plan_id=5]

(44) BroadcastHashJoin [codegen id : 9]
Left keys [1]: [c_customer_sk#59]
Right keys [1]: [cs_bill_customer_sk#73]
Join type: Inner
Join condition: None

(45) Project [codegen id : 9]
Output [12]: [c_customer_id#67, c_first_name#68, c_last_name#69, c_preferred_cust_flag#70, c_birth_country#64, c_login#71, c_email_address#72, cs_ext_discount_amt#74, cs_ext_sales_price#75, cs_ext_wholesale_cost#76, cs_ext_list_price#77, cs_sold_date_sk#78]
Input [14]: [c_customer_sk#59, c_customer_id#67, c_first_name#68, c_last_name#69, c_preferred_cust_flag#70, c_birth_country#64, c_login#71, c_email_address#72, cs_bill_customer_sk#73, cs_ext_discount_amt#74, cs_ext_sales_price#75, cs_ext_wholesale_cost#76, cs_ext_list_price#77, cs_sold_date_sk#78]

(46) ReusedExchange [Reuses operator id: 119]
Output [2]: [d_date_sk#79, d_year#80]

(47) BroadcastHashJoin [codegen id : 9]
Left keys [1]: [cs_sold_date_sk#78]
Right keys [1]: [d_date_sk#79]
Join type: Inner
Join condition: None

(48) Project [codegen id : 9]
Output [12]: [c_customer_id#67, c_first_name#68, c_last_name#69, c_preferred_cust_flag#70, c_birth_country#64, c_login#71, c_email_address#72, cs_ext_discount_amt#74, cs_ext_sales_price#75, cs_ext_wholesale_cost#76, cs_ext_list_price#77, d_year#80]
Input [14]: [c_customer_id#67, c_first_name#68, c_last_name#69, c_preferred_cust_flag#70, c_birth_country#64, c_login#71, c_email_address#72, cs_ext_discount_amt#74, cs_ext_sales_price#75, cs_ext_wholesale_cost#76, cs_ext_list_price#77, cs_sold_date_sk#78, d_date_sk#79, d_year#80]

(49) HashAggregate [codegen id : 9]
Input [12]: [c_customer_id#67, c_first_name#68, c_last_name#69, c_preferred_cust_flag#70, c_birth_country#64, c_login#71, c_email_address#72, cs_ext_discount_amt#74, cs_ext_sales_price#75, cs_ext_wholesale_cost#76, cs_ext_list_price#77, d_year#80]
Keys [8]: [c_customer_id#67, c_first_name#68, c_last_name#69, c_preferred_cust_flag#70, c_birth_country#64, c_login#71, c_email_address#72, d_year#80]
Functions [1]: [partial_sum(((((cs_ext_list_price#77 - cs_ext_wholesale_cost#76) - cs_ext_discount_amt#74) + cs_ext_sales_price#75) / 2))]
Aggregate Attributes [2]: [sum#81, isEmpty#82]
Results [10]: [c_customer_id#67, c_first_name#68, c_last_name#69, c_preferred_cust_flag#70, c_birth_country#64, c_login#71, c_email_address#72, d_year#80, sum#83, isEmpty#84]

(50) CometColumnarExchange
Input [10]: [c_customer_id#67, c_first_name#68, c_last_name#69, c_preferred_cust_flag#70, c_birth_country#64, c_login#71, c_email_address#72, d_year#80, sum#83, isEmpty#84]
Arguments: hashpartitioning(c_customer_id#67, c_first_name#68, c_last_name#69, c_preferred_cust_flag#70, c_birth_country#64, c_login#71, c_email_address#72, d_year#80, 5), ENSURE_REQUIREMENTS, CometColumnarShuffle, [plan_id=6]

(51) CometHashAggregate
Input [10]: [c_customer_id#67, c_first_name#68, c_last_name#69, c_preferred_cust_flag#70, c_birth_country#64, c_login#71, c_email_address#72, d_year#80, sum#83, isEmpty#84]
Keys [8]: [c_customer_id#67, c_first_name#68, c_last_name#69, c_preferred_cust_flag#70, c_birth_country#64, c_login#71, c_email_address#72, d_year#80]
Functions [1]: [sum(((((cs_ext_list_price#77 - cs_ext_wholesale_cost#76) - cs_ext_discount_amt#74) + cs_ext_sales_price#75) / 2))]

(52) CometFilter
Input [2]: [customer_id#85, year_total#86]
Condition : (isnotnull(year_total#86) AND (year_total#86 > 0.000000))

(53) CometBroadcastExchange
Input [2]: [customer_id#85, year_total#86]
Arguments: [customer_id#85, year_total#86]

(54) CometBroadcastHashJoin
Left output [10]: [customer_id#28, year_total#29, customer_id#51, customer_first_name#52, customer_last_name#53, customer_preferred_cust_flag#54, customer_birth_country#55, customer_login#56, customer_email_address#57, year_total#58]
Right output [2]: [customer_id#85, year_total#86]
Arguments: [customer_id#28], [customer_id#85], Inner, BuildRight

(55) CometProject
Input [12]: [customer_id#28, year_total#29, customer_id#51, customer_first_name#52, customer_last_name#53, customer_preferred_cust_flag#54, customer_birth_country#55, customer_login#56, customer_email_address#57, year_total#58, customer_id#85, year_total#86]
Arguments: [customer_id#28, year_total#29, customer_id#51, customer_first_name#52, customer_last_name#53, customer_preferred_cust_flag#54, customer_birth_country#55, customer_login#56, customer_email_address#57, year_total#58, year_total#86], [customer_id#28, year_total#29, customer_id#51, customer_first_name#52, customer_last_name#53, customer_preferred_cust_flag#54, customer_birth_country#55, customer_login#56, customer_email_address#57, year_total#58, year_total#86]

(56) CometNativeScan parquet spark_catalog.default.customer
Output [8]: [c_customer_sk#87, c_customer_id#88, c_first_name#89, c_last_name#90, c_preferred_cust_flag#91, c_birth_country#92, c_login#93, c_email_address#94]
Batched: true
Location [not included in comparison]/{warehouse_dir}/customer]
PushedFilters: [IsNotNull(c_customer_sk)]
ReadSchema: struct<c_customer_sk:int,c_customer_id:string,c_first_name:string,c_last_name:string,c_preferred_cust_flag:string,c_birth_country:string,c_login:string,c_email_address:string>

(57) CometFilter
Input [8]: [c_customer_sk#87, c_customer_id#88, c_first_name#89, c_last_name#90, c_preferred_cust_flag#91, c_birth_country#92, c_login#93, c_email_address#94]
Condition : (isnotnull(c_customer_sk#87) AND isnotnull(staticinvoke(class org.apache.spark.sql.catalyst.util.CharVarcharCodegenUtils, StringType, readSidePadding, c_customer_id#88, 16, true, false, true)))

(58) CometProject
Input [8]: [c_customer_sk#87, c_customer_id#88, c_first_name#89, c_last_name#90, c_preferred_cust_flag#91, c_birth_country#92, c_login#93, c_email_address#94]
Arguments: [c_customer_sk#87, c_customer_id#67, c_first_name#68, c_last_name#69, c_preferred_cust_flag#70, c_birth_country#92, c_login#71, c_email_address#72], [c_customer_sk#87, staticinvoke(class org.apache.spark.sql.catalyst.util.CharVarcharCodegenUtils, StringType, readSidePadding, c_customer_id#88, 16, true, false, true) AS c_customer_id#67, staticinvoke(class org.apache.spark.sql.catalyst.util.CharVarcharCodegenUtils, StringType, readSidePadding, c_first_name#89, 20, true, false, true) AS c_first_name#68, staticinvoke(class org.apache.spark.sql.catalyst.util.CharVarcharCodegenUtils, StringType, readSidePadding, c_last_name#90, 30, true, false, true) AS c_last_name#69, staticinvoke(class org.apache.spark.sql.catalyst.util.CharVarcharCodegenUtils, StringType, readSidePadding, c_preferred_cust_flag#91, 1, true, false, true) AS c_preferred_cust_flag#70, c_birth_country#92, staticinvoke(class org.apache.spark.sql.catalyst.util.CharVarcharCodegenUtils, StringType, readSidePadding, c_login#93, 13, true, false, true) AS c_login#71, staticinvoke(class org.apache.spark.sql.catalyst.util.CharVarcharCodegenUtils, StringType, readSidePadding, c_email_address#94, 50, true, false, true) AS c_email_address#72]

(59) CometColumnarToRow [codegen id : 12]
Input [8]: [c_customer_sk#87, c_customer_id#67, c_first_name#68, c_last_name#69, c_preferred_cust_flag#70, c_birth_country#92, c_login#71, c_email_address#72]

(60) Scan parquet spark_catalog.default.catalog_sales
Output [6]: [cs_bill_customer_sk#95, cs_ext_discount_amt#96, cs_ext_sales_price#97, cs_ext_wholesale_cost#98, cs_ext_list_price#99, cs_sold_date_sk#100]
Batched: true
Location: InMemoryFileIndex []
PartitionFilters: [isnotnull(cs_sold_date_sk#100), dynamicpruningexpression(cs_sold_date_sk#100 IN dynamicpruning#44)]
PushedFilters: [IsNotNull(cs_bill_customer_sk)]
ReadSchema: struct<cs_bill_customer_sk:int,cs_ext_discount_amt:decimal(7,2),cs_ext_sales_price:decimal(7,2),cs_ext_wholesale_cost:decimal(7,2),cs_ext_list_price:decimal(7,2)>

(61) ColumnarToRow [codegen id : 10]
Input [6]: [cs_bill_customer_sk#95, cs_ext_discount_amt#96, cs_ext_sales_price#97, cs_ext_wholesale_cost#98, cs_ext_list_price#99, cs_sold_date_sk#100]

(62) Filter [codegen id : 10]
Input [6]: [cs_bill_customer_sk#95, cs_ext_discount_amt#96, cs_ext_sales_price#97, cs_ext_wholesale_cost#98, cs_ext_list_price#99, cs_sold_date_sk#100]
Condition : isnotnull(cs_bill_customer_sk#95)

(63) BroadcastExchange
Input [6]: [cs_bill_customer_sk#95, cs_ext_discount_amt#96, cs_ext_sales_price#97, cs_ext_wholesale_cost#98, cs_ext_list_price#99, cs_sold_date_sk#100]
Arguments: HashedRelationBroadcastMode(List(cast(input[0, int, false] as bigint)),false), [plan_id=7]

(64) BroadcastHashJoin [codegen id : 12]
Left keys [1]: [c_customer_sk#87]
Right keys [1]: [cs_bill_customer_sk#95]
Join type: Inner
Join condition: None

(65) Project [codegen id : 12]
Output [12]: [c_customer_id#67, c_first_name#68, c_last_name#69, c_preferred_cust_flag#70, c_birth_country#92, c_login#71, c_email_address#72, cs_ext_discount_amt#96, cs_ext_sales_price#97, cs_ext_wholesale_cost#98, cs_ext_list_price#99, cs_sold_date_sk#100]
Input [14]: [c_customer_sk#87, c_customer_id#67, c_first_name#68, c_last_name#69, c_preferred_cust_flag#70, c_birth_country#92, c_login#71, c_email_address#72, cs_bill_customer_sk#95, cs_ext_discount_amt#96, cs_ext_sales_price#97, cs_ext_wholesale_cost#98, cs_ext_list_price#99, cs_sold_date_sk#100]

(66) ReusedExchange [Reuses operator id: 123]
Output [2]: [d_date_sk#101, d_year#102]

(67) BroadcastHashJoin [codegen id : 12]
Left keys [1]: [cs_sold_date_sk#100]
Right keys [1]: [d_date_sk#101]
Join type: Inner
Join condition: None

(68) Project [codegen id : 12]
Output [12]: [c_customer_id#67, c_first_name#68, c_last_name#69, c_preferred_cust_flag#70, c_birth_country#92, c_login#71, c_email_address#72, cs_ext_discount_amt#96, cs_ext_sales_price#97, cs_ext_wholesale_cost#98, cs_ext_list_price#99, d_year#102]
Input [14]: [c_customer_id#67, c_first_name#68, c_last_name#69, c_preferred_cust_flag#70, c_birth_country#92, c_login#71, c_email_address#72, cs_ext_discount_amt#96, cs_ext_sales_price#97, cs_ext_wholesale_cost#98, cs_ext_list_price#99, cs_sold_date_sk#100, d_date_sk#101, d_year#102]

(69) HashAggregate [codegen id : 12]
Input [12]: [c_customer_id#67, c_first_name#68, c_last_name#69, c_preferred_cust_flag#70, c_birth_country#92, c_login#71, c_email_address#72, cs_ext_discount_amt#96, cs_ext_sales_price#97, cs_ext_wholesale_cost#98, cs_ext_list_price#99, d_year#102]
Keys [8]: [c_customer_id#67, c_first_name#68, c_last_name#69, c_preferred_cust_flag#70, c_birth_country#92, c_login#71, c_email_address#72, d_year#102]
Functions [1]: [partial_sum(((((cs_ext_list_price#99 - cs_ext_wholesale_cost#98) - cs_ext_discount_amt#96) + cs_ext_sales_price#97) / 2))]
Aggregate Attributes [2]: [sum#103, isEmpty#104]
Results [10]: [c_customer_id#67, c_first_name#68, c_last_name#69, c_preferred_cust_flag#70, c_birth_country#92, c_login#71, c_email_address#72, d_year#102, sum#105, isEmpty#106]

(70) CometColumnarExchange
Input [10]: [c_customer_id#67, c_first_name#68, c_last_name#69, c_preferred_cust_flag#70, c_birth_country#92, c_login#71, c_email_address#72, d_year#102, sum#105, isEmpty#106]
Arguments: hashpartitioning(c_customer_id#67, c_first_name#68, c_last_name#69, c_preferred_cust_flag#70, c_birth_country#92, c_login#71, c_email_address#72, d_year#102, 5), ENSURE_REQUIREMENTS, CometColumnarShuffle, [plan_id=8]

(71) CometHashAggregate
Input [10]: [c_customer_id#67, c_first_name#68, c_last_name#69, c_preferred_cust_flag#70, c_birth_country#92, c_login#71, c_email_address#72, d_year#102, sum#105, isEmpty#106]
Keys [8]: [c_customer_id#67, c_first_name#68, c_last_name#69, c_preferred_cust_flag#70, c_birth_country#92, c_login#71, c_email_address#72, d_year#102]
Functions [1]: [sum(((((cs_ext_list_price#99 - cs_ext_wholesale_cost#98) - cs_ext_discount_amt#96) + cs_ext_sales_price#97) / 2))]

(72) CometBroadcastExchange
Input [2]: [customer_id#107, year_total#108]
Arguments: [customer_id#107, year_total#108]

(73) CometBroadcastHashJoin
Left output [11]: [customer_id#28, year_total#29, customer_id#51, customer_first_name#52, customer_last_name#53, customer_preferred_cust_flag#54, customer_birth_country#55, customer_login#56, customer_email_address#57, year_total#58, year_total#86]
Right output [2]: [customer_id#107, year_total#108]
Arguments: [customer_id#28], [customer_id#107], Inner, (CASE WHEN (year_total#86 > 0.000000) THEN (year_total#108 / year_total#86) END > CASE WHEN (year_total#29 > 0.000000) THEN (year_total#58 / year_total#29) END), BuildRight

(74) CometProject
Input [13]: [customer_id#28, year_total#29, customer_id#51, customer_first_name#52, customer_last_name#53, customer_preferred_cust_flag#54, customer_birth_country#55, customer_login#56, customer_email_address#57, year_total#58, year_total#86, customer_id#107, year_total#108]
Arguments: [customer_id#28, customer_id#51, customer_first_name#52, customer_last_name#53, customer_preferred_cust_flag#54, customer_birth_country#55, customer_login#56, customer_email_address#57, year_total#86, year_total#108], [customer_id#28, customer_id#51, customer_first_name#52, customer_last_name#53, customer_preferred_cust_flag#54, customer_birth_country#55, customer_login#56, customer_email_address#57, year_total#86, year_total#108]

(75) CometNativeScan parquet spark_catalog.default.customer
Output [8]: [c_customer_sk#109, c_customer_id#110, c_first_name#111, c_last_name#112, c_preferred_cust_flag#113, c_birth_country#114, c_login#115, c_email_address#116]
Batched: true
Location [not included in comparison]/{warehouse_dir}/customer]
PushedFilters: [IsNotNull(c_customer_sk)]
ReadSchema: struct<c_customer_sk:int,c_customer_id:string,c_first_name:string,c_last_name:string,c_preferred_cust_flag:string,c_birth_country:string,c_login:string,c_email_address:string>

(76) CometFilter
Input [8]: [c_customer_sk#109, c_customer_id#110, c_first_name#111, c_last_name#112, c_preferred_cust_flag#113, c_birth_country#114, c_login#115, c_email_address#116]
Condition : (isnotnull(c_customer_sk#109) AND isnotnull(staticinvoke(class org.apache.spark.sql.catalyst.util.CharVarcharCodegenUtils, StringType, readSidePadding, c_customer_id#110, 16, true, false, true)))

(77) CometProject
Input [8]: [c_customer_sk#109, c_customer_id#110, c_first_name#111, c_last_name#112, c_preferred_cust_flag#113, c_birth_country#114, c_login#115, c_email_address#116]
Arguments: [c_customer_sk#109, c_customer_id#117, c_first_name#118, c_last_name#119, c_preferred_cust_flag#120, c_birth_country#114, c_login#121, c_email_address#122], [c_customer_sk#109, staticinvoke(class org.apache.spark.sql.catalyst.util.CharVarcharCodegenUtils, StringType, readSidePadding, c_customer_id#110, 16, true, false, true) AS c_customer_id#117, staticinvoke(class org.apache.spark.sql.catalyst.util.CharVarcharCodegenUtils, StringType, readSidePadding, c_first_name#111, 20, true, false, true) AS c_first_name#118, staticinvoke(class org.apache.spark.sql.catalyst.util.CharVarcharCodegenUtils, StringType, readSidePadding, c_last_name#112, 30, true, false, true) AS c_last_name#119, staticinvoke(class org.apache.spark.sql.catalyst.util.CharVarcharCodegenUtils, StringType, readSidePadding, c_preferred_cust_flag#113, 1, true, false, true) AS c_preferred_cust_flag#120, c_birth_country#114, staticinvoke(class org.apache.spark.sql.catalyst.util.CharVarcharCodegenUtils, StringType, readSidePadding, c_login#115, 13, true, false, true) AS c_login#121, staticinvoke(class org.apache.spark.sql.catalyst.util.CharVarcharCodegenUtils, StringType, readSidePadding, c_email_address#116, 50, true, false, true) AS c_email_address#122]

(78) CometColumnarToRow [codegen id : 15]
Input [8]: [c_customer_sk#109, c_customer_id#117, c_first_name#118, c_last_name#119, c_preferred_cust_flag#120, c_birth_country#114, c_login#121, c_email_address#122]

(79) Scan parquet spark_catalog.default.web_sales
Output [6]: [ws_bill_customer_sk#123, ws_ext_discount_amt#124, ws_ext_sales_price#125, ws_ext_wholesale_cost#126, ws_ext_list_price#127, ws_sold_date_sk#128]
Batched: true
Location: InMemoryFileIndex []
PartitionFilters: [isnotnull(ws_sold_date_sk#128), dynamicpruningexpression(ws_sold_date_sk#128 IN dynamicpruning#21)]
PushedFilters: [IsNotNull(ws_bill_customer_sk)]
ReadSchema: struct<ws_bill_customer_sk:int,ws_ext_discount_amt:decimal(7,2),ws_ext_sales_price:decimal(7,2),ws_ext_wholesale_cost:decimal(7,2),ws_ext_list_price:decimal(7,2)>

(80) ColumnarToRow [codegen id : 13]
Input [6]: [ws_bill_customer_sk#123, ws_ext_discount_amt#124, ws_ext_sales_price#125, ws_ext_wholesale_cost#126, ws_ext_list_price#127, ws_sold_date_sk#128]

(81) Filter [codegen id : 13]
Input [6]: [ws_bill_customer_sk#123, ws_ext_discount_amt#124, ws_ext_sales_price#125, ws_ext_wholesale_cost#126, ws_ext_list_price#127, ws_sold_date_sk#128]
Condition : isnotnull(ws_bill_customer_sk#123)

(82) BroadcastExchange
Input [6]: [ws_bill_customer_sk#123, ws_ext_discount_amt#124, ws_ext_sales_price#125, ws_ext_wholesale_cost#126, ws_ext_list_price#127, ws_sold_date_sk#128]
Arguments: HashedRelationBroadcastMode(List(cast(input[0, int, false] as bigint)),false), [plan_id=9]

(83) BroadcastHashJoin [codegen id : 15]
Left keys [1]: [c_customer_sk#109]
Right keys [1]: [ws_bill_customer_sk#123]
Join type: Inner
Join condition: None

(84) Project [codegen id : 15]
Output [12]: [c_customer_id#117, c_first_name#118, c_last_name#119, c_preferred_cust_flag#120, c_birth_country#114, c_login#121, c_email_address#122, ws_ext_discount_amt#124, ws_ext_sales_price#125, ws_ext_wholesale_cost#126, ws_ext_list_price#127, ws_sold_date_sk#128]
Input [14]: [c_customer_sk#109, c_customer_id#117, c_first_name#118, c_last_name#119, c_preferred_cust_flag#120, c_birth_country#114, c_login#121, c_email_address#122, ws_bill_customer_sk#123, ws_ext_discount_amt#124, ws_ext_sales_price#125, ws_ext_wholesale_cost#126, ws_ext_list_price#127, ws_sold_date_sk#128]

(85) ReusedExchange [Reuses operator id: 119]
Output [2]: [d_date_sk#129, d_year#130]

(86) BroadcastHashJoin [codegen id : 15]
Left keys [1]: [ws_sold_date_sk#128]
Right keys [1]: [d_date_sk#129]
Join type: Inner
Join condition: None

(87) Project [codegen id : 15]
Output [12]: [c_customer_id#117, c_first_name#118, c_last_name#119, c_preferred_cust_flag#120, c_birth_country#114, c_login#121, c_email_address#122, ws_ext_discount_amt#124, ws_ext_sales_price#125, ws_ext_wholesale_cost#126, ws_ext_list_price#127, d_year#130]
Input [14]: [c_customer_id#117, c_first_name#118, c_last_name#119, c_preferred_cust_flag#120, c_birth_country#114, c_login#121, c_email_address#122, ws_ext_discount_amt#124, ws_ext_sales_price#125, ws_ext_wholesale_cost#126, ws_ext_list_price#127, ws_sold_date_sk#128, d_date_sk#129, d_year#130]

(88) HashAggregate [codegen id : 15]
Input [12]: [c_customer_id#117, c_first_name#118, c_last_name#119, c_preferred_cust_flag#120, c_birth_country#114, c_login#121, c_email_address#122, ws_ext_discount_amt#124, ws_ext_sales_price#125, ws_ext_wholesale_cost#126, ws_ext_list_price#127, d_year#130]
Keys [8]: [c_customer_id#117, c_first_name#118, c_last_name#119, c_preferred_cust_flag#120, c_birth_country#114, c_login#121, c_email_address#122, d_year#130]
Functions [1]: [partial_sum(((((ws_ext_list_price#127 - ws_ext_wholesale_cost#126) - ws_ext_discount_amt#124) + ws_ext_sales_price#125) / 2))]
Aggregate Attributes [2]: [sum#131, isEmpty#132]
Results [10]: [c_customer_id#117, c_first_name#118, c_last_name#119, c_preferred_cust_flag#120, c_birth_country#114, c_login#121, c_email_address#122, d_year#130, sum#133, isEmpty#134]

(89) CometColumnarExchange
Input [10]: [c_customer_id#117, c_first_name#118, c_last_name#119, c_preferred_cust_flag#120, c_birth_country#114, c_login#121, c_email_address#122, d_year#130, sum#133, isEmpty#134]
Arguments: hashpartitioning(c_customer_id#117, c_first_name#118, c_last_name#119, c_preferred_cust_flag#120, c_birth_country#114, c_login#121, c_email_address#122, d_year#130, 5), ENSURE_REQUIREMENTS, CometColumnarShuffle, [plan_id=10]

(90) CometHashAggregate
Input [10]: [c_customer_id#117, c_first_name#118, c_last_name#119, c_preferred_cust_flag#120, c_birth_country#114, c_login#121, c_email_address#122, d_year#130, sum#133, isEmpty#134]
Keys [8]: [c_customer_id#117, c_first_name#118, c_last_name#119, c_preferred_cust_flag#120, c_birth_country#114, c_login#121, c_email_address#122, d_year#130]
Functions [1]: [sum(((((ws_ext_list_price#127 - ws_ext_wholesale_cost#126) - ws_ext_discount_amt#124) + ws_ext_sales_price#125) / 2))]

(91) CometFilter
Input [2]: [customer_id#135, year_total#136]
Condition : (isnotnull(year_total#136) AND (year_total#136 > 0.000000))

(92) CometBroadcastExchange
Input [2]: [customer_id#135, year_total#136]
Arguments: [customer_id#135, year_total#136]

(93) CometBroadcastHashJoin
Left output [10]: [customer_id#28, customer_id#51, customer_first_name#52, customer_last_name#53, customer_preferred_cust_flag#54, customer_birth_country#55, customer_login#56, customer_email_address#57, year_total#86, year_total#108]
Right output [2]: [customer_id#135, year_total#136]
Arguments: [customer_id#28], [customer_id#135], Inner, BuildRight

(94) CometProject
Input [12]: [customer_id#28, customer_id#51, customer_first_name#52, customer_last_name#53, customer_preferred_cust_flag#54, customer_birth_country#55, customer_login#56, customer_email_address#57, year_total#86, year_total#108, customer_id#135, year_total#136]
Arguments: [customer_id#28, customer_id#51, customer_first_name#52, customer_last_name#53, customer_preferred_cust_flag#54, customer_birth_country#55, customer_login#56, customer_email_address#57, year_total#86, year_total#108, year_total#136], [customer_id#28, customer_id#51, customer_first_name#52, customer_last_name#53, customer_preferred_cust_flag#54, customer_birth_country#55, customer_login#56, customer_email_address#57, year_total#86, year_total#108, year_total#136]

(95) CometNativeScan parquet spark_catalog.default.customer
Output [8]: [c_customer_sk#137, c_customer_id#138, c_first_name#139, c_last_name#140, c_preferred_cust_flag#141, c_birth_country#142, c_login#143, c_email_address#144]
Batched: true
Location [not included in comparison]/{warehouse_dir}/customer]
PushedFilters: [IsNotNull(c_customer_sk)]
ReadSchema: struct<c_customer_sk:int,c_customer_id:string,c_first_name:string,c_last_name:string,c_preferred_cust_flag:string,c_birth_country:string,c_login:string,c_email_address:string>

(96) CometFilter
Input [8]: [c_customer_sk#137, c_customer_id#138, c_first_name#139, c_last_name#140, c_preferred_cust_flag#141, c_birth_country#142, c_login#143, c_email_address#144]
Condition : (isnotnull(c_customer_sk#137) AND isnotnull(staticinvoke(class org.apache.spark.sql.catalyst.util.CharVarcharCodegenUtils, StringType, readSidePadding, c_customer_id#138, 16, true, false, true)))

(97) CometProject
Input [8]: [c_customer_sk#137, c_customer_id#138, c_first_name#139, c_last_name#140, c_preferred_cust_flag#141, c_birth_country#142, c_login#143, c_email_address#144]
Arguments: [c_customer_sk#137, c_customer_id#117, c_first_name#118, c_last_name#119, c_preferred_cust_flag#120, c_birth_country#142, c_login#121, c_email_address#122], [c_customer_sk#137, staticinvoke(class org.apache.spark.sql.catalyst.util.CharVarcharCodegenUtils, StringType, readSidePadding, c_customer_id#138, 16, true, false, true) AS c_customer_id#117, staticinvoke(class org.apache.spark.sql.catalyst.util.CharVarcharCodegenUtils, StringType, readSidePadding, c_first_name#139, 20, true, false, true) AS c_first_name#118, staticinvoke(class org.apache.spark.sql.catalyst.util.CharVarcharCodegenUtils, StringType, readSidePadding, c_last_name#140, 30, true, false, true) AS c_last_name#119, staticinvoke(class org.apache.spark.sql.catalyst.util.CharVarcharCodegenUtils, StringType, readSidePadding, c_preferred_cust_flag#141, 1, true, false, true) AS c_preferred_cust_flag#120, c_birth_country#142, staticinvoke(class org.apache.spark.sql.catalyst.util.CharVarcharCodegenUtils, StringType, readSidePadding, c_login#143, 13, true, false, true) AS c_login#121, staticinvoke(class org.apache.spark.sql.catalyst.util.CharVarcharCodegenUtils, StringType, readSidePadding, c_email_address#144, 50, true, false, true) AS c_email_address#122]

(98) CometColumnarToRow [codegen id : 18]
Input [8]: [c_customer_sk#137, c_customer_id#117, c_first_name#118, c_last_name#119, c_preferred_cust_flag#120, c_birth_country#142, c_login#121, c_email_address#122]

(99) Scan parquet spark_catalog.default.web_sales
Output [6]: [ws_bill_customer_sk#145, ws_ext_discount_amt#146, ws_ext_sales_price#147, ws_ext_wholesale_cost#148, ws_ext_list_price#149, ws_sold_date_sk#150]
Batched: true
Location: InMemoryFileIndex []
PartitionFilters: [isnotnull(ws_sold_date_sk#150), dynamicpruningexpression(ws_sold_date_sk#150 IN dynamicpruning#44)]
PushedFilters: [IsNotNull(ws_bill_customer_sk)]
ReadSchema: struct<ws_bill_customer_sk:int,ws_ext_discount_amt:decimal(7,2),ws_ext_sales_price:decimal(7,2),ws_ext_wholesale_cost:decimal(7,2),ws_ext_list_price:decimal(7,2)>

(100) ColumnarToRow [codegen id : 16]
Input [6]: [ws_bill_customer_sk#145, ws_ext_discount_amt#146, ws_ext_sales_price#147, ws_ext_wholesale_cost#148, ws_ext_list_price#149, ws_sold_date_sk#150]

(101) Filter [codegen id : 16]
Input [6]: [ws_bill_customer_sk#145, ws_ext_discount_amt#146, ws_ext_sales_price#147, ws_ext_wholesale_cost#148, ws_ext_list_price#149, ws_sold_date_sk#150]
Condition : isnotnull(ws_bill_customer_sk#145)

(102) BroadcastExchange
Input [6]: [ws_bill_customer_sk#145, ws_ext_discount_amt#146, ws_ext_sales_price#147, ws_ext_wholesale_cost#148, ws_ext_list_price#149, ws_sold_date_sk#150]
Arguments: HashedRelationBroadcastMode(List(cast(input[0, int, false] as bigint)),false), [plan_id=11]

(103) BroadcastHashJoin [codegen id : 18]
Left keys [1]: [c_customer_sk#137]
Right keys [1]: [ws_bill_customer_sk#145]
Join type: Inner
Join condition: None

(104) Project [codegen id : 18]
Output [12]: [c_customer_id#117, c_first_name#118, c_last_name#119, c_preferred_cust_flag#120, c_birth_country#142, c_login#121, c_email_address#122, ws_ext_discount_amt#146, ws_ext_sales_price#147, ws_ext_wholesale_cost#148, ws_ext_list_price#149, ws_sold_date_sk#150]
Input [14]: [c_customer_sk#137, c_customer_id#117, c_first_name#118, c_last_name#119, c_preferred_cust_flag#120, c_birth_country#142, c_login#121, c_email_address#122, ws_bill_customer_sk#145, ws_ext_discount_amt#146, ws_ext_sales_price#147, ws_ext_wholesale_cost#148, ws_ext_list_price#149, ws_sold_date_sk#150]

(105) ReusedExchange [Reuses operator id: 123]
Output [2]: [d_date_sk#151, d_year#152]

(106) BroadcastHashJoin [codegen id : 18]
Left keys [1]: [ws_sold_date_sk#150]
Right keys [1]: [d_date_sk#151]
Join type: Inner
Join condition: None

(107) Project [codegen id : 18]
Output [12]: [c_customer_id#117, c_first_name#118, c_last_name#119, c_preferred_cust_flag#120, c_birth_country#142, c_login#121, c_email_address#122, ws_ext_discount_amt#146, ws_ext_sales_price#147, ws_ext_wholesale_cost#148, ws_ext_list_price#149, d_year#152]
Input [14]: [c_customer_id#117, c_first_name#118, c_last_name#119, c_preferred_cust_flag#120, c_birth_country#142, c_login#121, c_email_address#122, ws_ext_discount_amt#146, ws_ext_sales_price#147, ws_ext_wholesale_cost#148, ws_ext_list_price#149, ws_sold_date_sk#150, d_date_sk#151, d_year#152]

(108) HashAggregate [codegen id : 18]
Input [12]: [c_customer_id#117, c_first_name#118, c_last_name#119, c_preferred_cust_flag#120, c_birth_country#142, c_login#121, c_email_address#122, ws_ext_discount_amt#146, ws_ext_sales_price#147, ws_ext_wholesale_cost#148, ws_ext_list_price#149, d_year#152]
Keys [8]: [c_customer_id#117, c_first_name#118, c_last_name#119, c_preferred_cust_flag#120, c_birth_country#142, c_login#121, c_email_address#122, d_year#152]
Functions [1]: [partial_sum(((((ws_ext_list_price#149 - ws_ext_wholesale_cost#148) - ws_ext_discount_amt#146) + ws_ext_sales_price#147) / 2))]
Aggregate Attributes [2]: [sum#153, isEmpty#154]
Results [10]: [c_customer_id#117, c_first_name#118, c_last_name#119, c_preferred_cust_flag#120, c_birth_country#142, c_login#121, c_email_address#122, d_year#152, sum#155, isEmpty#156]

(109) CometColumnarExchange
Input [10]: [c_customer_id#117, c_first_name#118, c_last_name#119, c_preferred_cust_flag#120, c_birth_country#142, c_login#121, c_email_address#122, d_year#152, sum#155, isEmpty#156]
Arguments: hashpartitioning(c_customer_id#117, c_first_name#118, c_last_name#119, c_preferred_cust_flag#120, c_birth_country#142, c_login#121, c_email_address#122, d_year#152, 5), ENSURE_REQUIREMENTS, CometColumnarShuffle, [plan_id=12]

(110) CometHashAggregate
Input [10]: [c_customer_id#117, c_first_name#118, c_last_name#119, c_preferred_cust_flag#120, c_birth_country#142, c_login#121, c_email_address#122, d_year#152, sum#155, isEmpty#156]
Keys [8]: [c_customer_id#117, c_first_name#118, c_last_name#119, c_preferred_cust_flag#120, c_birth_country#142, c_login#121, c_email_address#122, d_year#152]
Functions [1]: [sum(((((ws_ext_list_price#149 - ws_ext_wholesale_cost#148) - ws_ext_discount_amt#146) + ws_ext_sales_price#147) / 2))]

(111) CometBroadcastExchange
Input [2]: [customer_id#157, year_total#158]
Arguments: [customer_id#157, year_total#158]

(112) CometBroadcastHashJoin
Left output [11]: [customer_id#28, customer_id#51, customer_first_name#52, customer_last_name#53, customer_preferred_cust_flag#54, customer_birth_country#55, customer_login#56, customer_email_address#57, year_total#86, year_total#108, year_total#136]
Right output [2]: [customer_id#157, year_total#158]
Arguments: [customer_id#28], [customer_id#157], Inner, (CASE WHEN (year_total#86 > 0.000000) THEN (year_total#108 / year_total#86) END > CASE WHEN (year_total#136 > 0.000000) THEN (year_total#158 / year_total#136) END), BuildRight

(113) CometProject
Input [13]: [customer_id#28, customer_id#51, customer_first_name#52, customer_last_name#53, customer_preferred_cust_flag#54, customer_birth_country#55, customer_login#56, customer_email_address#57, year_total#86, year_total#108, year_total#136, customer_id#157, year_total#158]
Arguments: [customer_id#51, customer_first_name#52, customer_last_name#53, customer_preferred_cust_flag#54, customer_birth_country#55, customer_login#56, customer_email_address#57], [customer_id#51, customer_first_name#52, customer_last_name#53, customer_preferred_cust_flag#54, customer_birth_country#55, customer_login#56, customer_email_address#57]

(114) CometTakeOrderedAndProject
Input [7]: [customer_id#51, customer_first_name#52, customer_last_name#53, customer_preferred_cust_flag#54, customer_birth_country#55, customer_login#56, customer_email_address#57]
Arguments: TakeOrderedAndProject(limit=100, orderBy=[customer_id#51 ASC NULLS FIRST,customer_first_name#52 ASC NULLS FIRST,customer_last_name#53 ASC NULLS FIRST,customer_preferred_cust_flag#54 ASC NULLS FIRST,customer_birth_country#55 ASC NULLS FIRST,customer_login#56 ASC NULLS FIRST,customer_email_address#57 ASC NULLS FIRST], output=[customer_id#51,customer_first_name#52,customer_last_name#53,customer_preferred_cust_flag#54,customer_birth_country#55,customer_login#56,customer_email_address#57]), [customer_id#51, customer_first_name#52, customer_last_name#53, customer_preferred_cust_flag#54, customer_birth_country#55, customer_login#56, customer_email_address#57], 100, 0, [customer_id#51 ASC NULLS FIRST, customer_first_name#52 ASC NULLS FIRST, customer_last_name#53 ASC NULLS FIRST, customer_preferred_cust_flag#54 ASC NULLS FIRST, customer_birth_country#55 ASC NULLS FIRST, customer_login#56 ASC NULLS FIRST, customer_email_address#57 ASC NULLS FIRST], [customer_id#51, customer_first_name#52, customer_last_name#53, customer_preferred_cust_flag#54, customer_birth_country#55, customer_login#56, customer_email_address#57]

(115) CometColumnarToRow [codegen id : 19]
Input [7]: [customer_id#51, customer_first_name#52, customer_last_name#53, customer_preferred_cust_flag#54, customer_birth_country#55, customer_login#56, customer_email_address#57]

===== Subqueries =====

Subquery:1 Hosting operator id = 5 Hosting Expression = ss_sold_date_sk#20 IN dynamicpruning#21
BroadcastExchange (119)
+- * CometColumnarToRow (118)
   +- CometFilter (117)
      +- CometNativeScan parquet spark_catalog.default.date_dim (116)


(116) CometNativeScan parquet spark_catalog.default.date_dim
Output [2]: [d_date_sk#22, d_year#23]
Batched: true
Location [not included in comparison]/{warehouse_dir}/date_dim]
PushedFilters: [IsNotNull(d_year), EqualTo(d_year,2001), IsNotNull(d_date_sk)]
ReadSchema: struct<d_date_sk:int,d_year:int>

(117) CometFilter
Input [2]: [d_date_sk#22, d_year#23]
Condition : ((isnotnull(d_year#23) AND (d_year#23 = 2001)) AND isnotnull(d_date_sk#22))

(118) CometColumnarToRow [codegen id : 1]
Input [2]: [d_date_sk#22, d_year#23]

(119) BroadcastExchange
Input [2]: [d_date_sk#22, d_year#23]
Arguments: HashedRelationBroadcastMode(List(cast(input[0, int, false] as bigint)),false), [plan_id=13]

Subquery:2 Hosting operator id = 22 Hosting Expression = ss_sold_date_sk#43 IN dynamicpruning#44
BroadcastExchange (123)
+- * CometColumnarToRow (122)
   +- CometFilter (121)
      +- CometNativeScan parquet spark_catalog.default.date_dim (120)


(120) CometNativeScan parquet spark_catalog.default.date_dim
Output [2]: [d_date_sk#45, d_year#46]
Batched: true
Location [not included in comparison]/{warehouse_dir}/date_dim]
PushedFilters: [IsNotNull(d_year), EqualTo(d_year,2002), IsNotNull(d_date_sk)]
ReadSchema: struct<d_date_sk:int,d_year:int>

(121) CometFilter
Input [2]: [d_date_sk#45, d_year#46]
Condition : ((isnotnull(d_year#46) AND (d_year#46 = 2002)) AND isnotnull(d_date_sk#45))

(122) CometColumnarToRow [codegen id : 1]
Input [2]: [d_date_sk#45, d_year#46]

(123) BroadcastExchange
Input [2]: [d_date_sk#45, d_year#46]
Arguments: HashedRelationBroadcastMode(List(cast(input[0, int, false] as bigint)),false), [plan_id=14]

Subquery:3 Hosting operator id = 40 Hosting Expression = cs_sold_date_sk#78 IN dynamicpruning#21

Subquery:4 Hosting operator id = 60 Hosting Expression = cs_sold_date_sk#100 IN dynamicpruning#44

Subquery:5 Hosting operator id = 79 Hosting Expression = ws_sold_date_sk#128 IN dynamicpruning#21

Subquery:6 Hosting operator id = 99 Hosting Expression = ws_sold_date_sk#150 IN dynamicpruning#44


